<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingoQuest</title>

    <!-- App Icons, Manifest, and Theme Color -->
    <meta name="theme-color" content="#1F2335">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="LingoQuest">

    <!-- 1. The Web App Manifest (Primary method for modern Android) -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICAgIm5hbWUiOiAiTGluZ29RdWVzdCIsCiAgICAic2hvcnRfbmFtZSI6ICJMaW5nb1F1ZXN0IiwKICAgICJzdGFydF91cmwiOiAiLiIsCiAgICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAgICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMxRjIzMzUiLAogICAgInRoZW1lX2NvbG9yIjogIiMxRjIzMzUiLAogICAgImRlc2NyaXB0aW9uIjogIllvdXIgZGFpbHkgZG9zZSBvZiB2b2NhYnVsYXJ5LiIsCiAgICAiaWNvbnMiOiBbCiAgICAgIHsKICAgICAgICAgICJzcmMiOiAiaHR0cHM6Ly9pLmliYi5jby90WjVXZG5iL0xpbmdvLVF1ZXN0LUxvZ28tMi5wbmciLAogICAgICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogICAgICB9LAogICAgICB7CiAgICAgICAgICAic3JjIjogImh0dHBzOi8vaS5pYmIuY28vMlprNndNNC9MaW5nby1RdWVzdC1Mb2dvLTMucG5nIiwKICAgICAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgICAgfQogICAgXQogIH0=">

    <!-- 2. Fallback for iOS and older browsers -->
    <!-- Apple Touch Icon for iOS (180x180) -->
    <link rel="apple-touch-icon" href="https://i.ibb.co/PNSc0k7/Lingo-Quest-Logo-1.png?v=6">
    
    <!-- Favicon for desktop browsers (using the 192x192 as a reliable fallback) -->
    <link rel="icon" href="https://i.ibb.co/tZ5Wdnb/Lingo-Quest-Logo-2.png?v=6">


    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Nunito:wght@900&display=swap');
        
        :root {
            --bg-dark: #1F2335;
            --text-light: #f1f5f9;
            --text-muted: #a1a1aa;
            --accent-pink: #ec4899;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-yellow: #f59e0b;
        }

        html, body {
            overflow-x: hidden;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            overscroll-behavior-y: none;
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 1.5rem 1.5rem;
            position: relative;
        }

        /* Use Inter for more readable text blocks */
        .word-item p, #header-subtitle, #search-bar, .quiz-option, #search-suggestions div, .glass-ui h2, .dictionary-result, .mode-card p, .explanation-card p, .lesson-content {
             font-family: 'Inter', sans-serif;
        }

        .category-card {
            background-size: 200% 200%;
            transition: transform 0.3s ease, background-position 0.5s ease;
            aspect-ratio: 1 / 1;
        }
        .category-card:hover {
            transform: scale(1.03);
            background-position: right center;
        }
        
        .mode-card {
            transition: transform 0.3s ease, background-color 0.3s;
        }
        .mode-card:not([disabled]):hover {
            transform: scale(1.05);
            background-color: rgba(255, 255, 255, 0.15);
        }
        .mode-card[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
        }


        .grad-1 { background-image: linear-gradient(to right, #4338ca, #6d28d9, #be185d); }
        .grad-2 { background-image: linear-gradient(to right, #059669, #1d4ed8, #4f46e5); }
        .grad-3 { background-image: linear-gradient(to right, #db2777, #9333ea, #4a044e); }
        .grad-4 { background-image: linear-gradient(to right, #ea580c, #c026d3, #7e22ce); }
        .grad-5 { background-image: linear-gradient(to right, #16a34a, #0284c7, #4f46e5); }
        .grad-6 { background-image: linear-gradient(to right, #be123c, #b91c1c, #7f1d1d); }
        .grad-7 { background-image: linear-gradient(to right, #1d4ed8, #0ea5e9, #0284c7); } /* Study Hall Gradient */
        .grad-fav { background-image: linear-gradient(to right, #f59e0b, #facc15, #eab308); }
        .grad-nav { background-image: linear-gradient(to right, #4338ca, #be185d); }
        

        .word-item, .explanation-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
            border-radius: 0.75rem;
            will-change: transform;
        }
        .word-item {
            position: relative;
            perspective: 1000px;
            transform: translateZ(0);
        }
        .word-item:hover, .explanation-card:hover {
            transform: translateY(-2px) translateZ(0);
            box-shadow: 0 0 20px rgba(236, 72, 153, 0.4);
        }

        .explanation-card {
            background: rgba(255, 255, 255, 0.9);
            color: #1e293b;
        }

        .word-card-inner {
            display: grid;
            transition: transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform-style: preserve-3d;
            width: 100%;
        }
        .word-item.active .word-card-inner {
            transform: rotateY(180deg);
        }
        
        .glass-ui {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .word-content {
            grid-area: 1 / 1;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 0.75rem;
        }
        
        .word-content.front {
            background: rgba(255, 255, 255, 0.9);
            color: #1e293b;
        }
        
        .word-content.back {
            transform: rotateY(180deg);
            background: rgba(45, 52, 79, 0.8);
            color: var(--text-light);
        }

        @keyframes popIn {
            from { opacity: 0; transform: translateY(10px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .pop-in {
            animation: popIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            animation-fill-mode: backwards;
        }

        @keyframes tada {
            from { transform: scale(1); }
            10%, 20% { transform: scale(0.9) rotate(-3deg); }
            30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); }
            40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); }
            to { transform: scale(1) rotate(0); }
        }
        .celebrate {
            animation: tada 0.8s ease;
        }
        
        .quiz-option {
             transition: all 0.2s;
             border: 1px solid rgba(255, 255, 255, 0.3);
             color: var(--text-light);
             background: rgba(255, 255, 255, 0.1);
        }
        .quiz-option:hover { background-color: rgba(255, 255, 255, 0.2); }
        .quiz-option.correct { background-color: var(--accent-green) !important; color: white !important; }
        .quiz-option.incorrect { background-color: var(--accent-red) !important; color: white !important; }
        .quiz-option:disabled { opacity: 0.7; cursor: not-allowed; }

        .alphabet-button-active {
            background-color: var(--accent-pink) !important;
            color: white !important;
        }

        #bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        #bottom-nav.hidden {
            opacity: 0;
            transform: translateY(100%);
            pointer-events: none;
        }

        body.view-active {
            overflow: hidden;
        }
        #word-view.active {
            position: fixed;
            inset: 0;
            z-index: 40;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 1.5rem 1.5rem;
            overflow-y: auto;
        }
        
        .favorite-btn.favorited svg {
            fill: var(--accent-yellow);
            stroke: var(--accent-yellow);
        }

        #search-suggestions {
            max-height: 150px;
            overflow-y: auto;
        }
        
        /* Hide scrollbars */
        html::-webkit-scrollbar, body::-webkit-scrollbar, #word-view::-webkit-scrollbar, #search-suggestions::-webkit-scrollbar {
            display: none;
        }
        html, body, #word-view, #search-suggestions {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* --- Splash Screen --- */
        #splash-screen {
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 1.5rem 1.5rem;
        }
        @keyframes pinchOut {
            from {
                transform: scale(1);
                opacity: 1;
            }
            to {
                transform: scale(0.5);
                opacity: 0;
            }
        }
        .splash-out {
            animation: pinchOut 0.5s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards;
        }

        /* --- Study Hall Styles --- */
        .lesson-content h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-pink);
            padding-bottom: 0.25rem;
        }
        .lesson-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-light);
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
        }
        .lesson-content p {
            line-height: 1.6;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }
        .lesson-content .example {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 0.75rem;
            border-radius: 0.5rem;
            border-left: 4px solid var(--accent-green);
            margin: 1rem 0;
        }
         .lesson-content .example p {
             margin-bottom: 0;
             font-style: italic;
             color: var(--text-light);
         }
        .lesson-content .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }
        .lesson-content .comparison-table th,
        .lesson-content .comparison-table td {
            text-align: left;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
         .lesson-content .comparison-table th {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
         }
        .lesson-content ul.bullet-list {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-muted);
        }
         .lesson-content ul.bullet-list li {
            margin-bottom: 0.5rem;
         }
         #subtopic-section {
            padding-top: 1rem;
         }

        /* --- Profile Styles --- */
        .quiz-history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .quiz-history-item:last-child {
            border-bottom: none;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
        }
        .focus-card {
             background: rgba(255, 255, 255, 0.05);
             padding: 1rem;
             border-radius: 0.75rem;
             text-align: center;
             cursor: pointer;
             transition: background-color 0.2s;
        }
        .focus-card:hover {
            background: rgba(255, 255, 255, 0.1);
        }


        /* Styles for mobile-responsive tables */
        @media screen and (max-width: 640px) {
            .lesson-content .comparison-table {
                border: 0;
            }
            .lesson-content .comparison-table thead {
                display: none;
            }
            .lesson-content .comparison-table tr {
                display: block;
                margin-bottom: 1rem;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 0.5rem;
                overflow: hidden;
            }
            .lesson-content .comparison-table td {
                display: block;
                text-align: left;
                padding: 0.75rem;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            .lesson-content .comparison-table td:last-child {
                border-bottom: 0;
            }
            .lesson-content .comparison-table td::before {
                content: attr(data-label);
                display: block;
                font-weight: bold;
                color: white;
                margin-bottom: 0.25rem;
                font-size: 0.75rem;
                text-transform: uppercase;
                opacity: 0.6;
            }
        }
    </style>
</head>
<body class="flex min-h-screen">

    <div id="splash-screen" class="fixed inset-0 flex flex-col items-center justify-center z-50 p-8">
        <div class="flex-grow flex items-center justify-center">
            <svg viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg" class="w-full max-w-xs h-auto">
                <defs>
                    <linearGradient id="logo-gradient-1-splash" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#4338ca"/>
                        <stop offset="100%" stop-color="#6d28d9"/>
                    </linearGradient>
                    <linearGradient id="logo-gradient-2-splash" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#be185d"/>
                        <stop offset="100%" stop-color="#ec4899"/>
                    </linearGradient>
                </defs>
                <g transform="translate(10, 0)">
                    <text x="5" y="45" font-family="Nunito, sans-serif" font-size="30" font-weight="900" fill="url(#logo-gradient-1-splash)">Lingo</text>
                    <text x="85" y="45" font-family="Nunito, sans-serif" font-size="30" font-weight="900" fill="url(#logo-gradient-2-splash)">Quest</text>
                    <g transform="translate(135, 15) scale(0.8)">
                        <circle cx="12" cy="12" r="8" stroke="url(#logo-gradient-2-splash)" stroke-width="2.5" fill="none"/>
                        <line x1="17" y1="17" x2="22" y2="22" stroke="url(#logo-gradient-2-splash)" stroke-width="2.5" stroke-linecap="round"/>
                        <path d="M12 9.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5z" fill="#fff"/>
                        <path d="M12 14.5a2.5 2.5 0 0 0 0-5" fill="#fff"/>
                        <circle cx="9.5" cy="12" r="1" fill="url(#logo-gradient-1-splash)"/>
                        <circle cx="14.5" cy="12" r="1" fill="url(#logo-gradient-2-splash)"/>
                    </g>
                </g>
            </svg>
        </div>
        <div class="absolute bottom-4 text-center text-xs text-slate-500">
            <p>© 2025 British Institute Of English Language And P.D.</p>
            <p>All Rights Reserved.</p>
        </div>
    </div>
    
    <div id="app-container" class="max-w-2xl lg:max-w-5xl m-auto w-full p-4 relative z-10 opacity-0 transition-opacity duration-500">

        <!-- Main View for Categories -->
        <div id="category-view">
             <header id="main-header" class="relative z-10 pt-6 px-4 mb-6">
                <!-- Top bar for buttons -->
                <div class="flex justify-between items-center mb-4">
                    <button id="profile-btn" class="hidden p-2 rounded-full text-slate-400 hover:bg-white/10 hover:text-white transition-colors" aria-label="My Profile">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    </button>
                    <button id="about-btn" class="p-2 rounded-full text-slate-400 hover:bg-white/10 hover:text-white transition-colors" aria-label="About this app">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </button>
                </div>
                <!-- Logo container -->
                <div class="text-center">
                    <svg viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg" class="mx-auto max-w-[220px] sm:max-w-xs h-auto">
                        <defs>
                            <linearGradient id="logo-gradient-1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#4338ca"/>
                                <stop offset="100%" stop-color="#6d28d9"/>
                            </linearGradient>
                            <linearGradient id="logo-gradient-2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#be185d"/>
                                <stop offset="100%" stop-color="#ec4899"/>
                            </linearGradient>
                        </defs>
                        <g transform="translate(10, 0)">
                            <text x="5" y="45" font-family="Nunito, sans-serif" font-size="30" font-weight="900" fill="url(#logo-gradient-1)">Lingo</text>
                            <text x="85" y="45" font-family="Nunito, sans-serif" font-size="30" font-weight="900" fill="url(#logo-gradient-2)">Quest</text>
                            <g transform="translate(135, 15) scale(0.8)">
                                <circle cx="12" cy="12" r="8" stroke="url(#logo-gradient-2)" stroke-width="2.5" fill="none"/>
                                <line x1="17" y1="17" x2="22" y2="22" stroke="url(#logo-gradient-2)" stroke-width="2.5" stroke-linecap="round"/>
                                <path d="M12 9.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5z" fill="#fff"/>
                                <path d="M12 14.5a2.5 2.5 0 0 0 0-5" fill="#fff"/>
                                <circle cx="9.5" cy="12" r="1" fill="url(#logo-gradient-1)"/>
                                <circle cx="14.5" cy="12" r="1" fill="url(#logo-gradient-2)"/>
                            </g>
                        </g>
                    </svg>
                    <p id="header-subtitle" class="text-base text-slate-300 mt-2">Your daily dose of vocabulary.</p>
                </div>
            </header>
            
            <!-- Search -->
            <div id="home-features" class="px-4 mb-6 relative z-20 max-w-md mx-auto">
                <div class="relative" id="search-container">
                    <input type="text" id="search-bar" placeholder="Search for a word..." class="w-full bg-white/10 text-white placeholder-white/50 border-2 border-transparent focus:border-pink-500 focus:bg-white/20 rounded-full py-2 px-5 outline-none transition-all">
                    <svg class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-white/50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <div id="search-suggestions" class="absolute top-full left-0 right-0 mt-2 bg-slate-700/90 backdrop-blur-sm rounded-2xl z-20 hidden"></div>
                </div>
            </div>

            <main id="category-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 relative z-10 px-4"></main>
            
            <footer class="text-center text-xs text-slate-500 mt-8 pb-4 px-4">
                <p>Product of British Institute Of English Language And P.D.</p>
            </footer>
        </div>

        <!-- View for Word Lists and Quizzes -->
        <div id="word-view" class="hidden">
            <!-- Content will be injected by JS -->
        </div>

    </div>

    <!-- Bottom Navigation Bar -->
    <nav id="bottom-nav" class="hidden bg-[#1F2335]">
        <div class="max-w-2xl lg:max-w-5xl mx-auto p-1">
            <div class="grad-nav rounded-full flex justify-around items-center p-1">
                <button id="nav-back" class="p-1 rounded-full hover:bg-white/20 transition-colors text-white" aria-label="Back">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
                </button>
                <button id="nav-home" class="p-1 rounded-full hover:bg-white/20 transition-colors text-white" aria-label="Home">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                </button>
                 <button id="nav-favorites" class="p-1 rounded-full hover:bg-white/20 transition-colors text-white" aria-label="Favorites">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
                </button>
                <button id="nav-quiz" class="p-1 rounded-full hover:bg-white/20 transition-colors text-white disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Start Quiz">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                </button>
            </div>
        </div>
    </nav>
    
    <!-- About Modal -->
    <div id="about-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="glass-ui p-6 rounded-2xl max-w-lg w-full relative pop-in">
            <button id="close-about-modal" class="absolute top-2 right-2 p-2 text-slate-400 hover:text-white transition-colors" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <h2 class="text-2xl font-bold text-white mb-4">About LingoQuest</h2>
            <p class="text-slate-300 mb-6">This application was developed by Akash Sawle, for the students of the British Institute Of English Language And P.D.</p>
            
            <div class="border-t border-white/20 pt-4 mb-6">
                <h3 class="font-bold text-white mb-2">By:</h3>
                <p class="text-slate-300 font-semibold">British Institute Of English Language And P.D.</p>
                <p class="text-xs text-slate-400 mt-1">
                    987-A, Above Punjab National Bank, Sudama Nagar Sector-D, Near Footi Kothi Square, Indore. Madhyapradesh.
                </p>
                <p class="text-xs text-slate-400 mt-2">
                    <strong>Cont. No. :</strong> +91-6232360306, 0731-402-6644
                </p>
            </div>

            <div class="border-t border-white/20 pt-4">
                <h3 class="font-bold text-white mb-2">Legal Notice</h3>
                <p class="text-xs text-slate-400">
                    © 2025 British Institute Of English Language And P.D. All Rights Reserved.
                    <br><br>
                    This application and its content are the exclusive intellectual property of the British Institute Of English Language And P.D. It is provided for the sole use of its registered students and staff.
                    <br><br>
                    Unauthorized copying, reproduction, redistribution, or use of this application by any other person, business, or educational institute is strictly prohibited and will be subject to legal action.
                </p>
            </div>
        </div>
    </div>

    <!-- Explanation Modal -->
    <div id="explanation-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="glass-ui p-6 rounded-2xl max-w-lg w-full relative pop-in">
            <button id="close-explanation-modal" class="absolute top-2 right-2 p-2 text-slate-400 hover:text-white transition-colors" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <div id="explanation-content" class="text-white"></div>
        </div>
    </div>
    
    <!-- Profile Setup Modal -->
    <div id="profile-setup-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="glass-ui p-6 rounded-2xl max-w-lg w-full relative pop-in">
             <h2 class="text-2xl font-bold text-white mb-2 text-center">Welcome to LingoQuest!</h2>
             <p class="text-slate-300 text-center mb-6">Let's set up your profile.</p>

             <div class="mb-4">
                 <label for="username-input" class="block text-sm font-bold text-slate-200 mb-2">Enter your name:</label>
                 <input type="text" id="username-input" placeholder="Your Name" class="w-full bg-white/10 text-white placeholder-white/50 border-2 border-transparent focus:border-pink-500 focus:bg-white/20 rounded-lg py-2 px-4 outline-none transition-all">
             </div>

             <button id="save-profile-btn" class="w-full grad-nav text-white font-bold py-3 px-4 rounded-lg disabled:opacity-50" disabled>Let's Go!</button>
        </div>
    </div>
    
    <!-- User Profile Modal -->
    <div id="user-profile-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="glass-ui p-6 rounded-2xl max-w-lg w-full relative pop-in">
            <button id="close-user-profile-modal" class="absolute top-2 right-2 p-2 text-slate-400 hover:text-white transition-colors" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
             <div id="user-profile-content" class="text-white">
                <!-- User profile details will be injected here -->
             </div>
        </div>
    </div>


    <script>
        // Force manual scroll restoration to prevent browser from interfering
        if (history.scrollRestoration) {
            history.scrollRestoration = 'manual';
        }

        document.addEventListener('DOMContentLoaded', () => {
             const detailedExplanations = {
                "Affect vs. Effect": `
                    <h3 class="text-2xl font-bold mb-4">Affect vs. Effect</h3>
                    <div class="space-y-4 text-slate-300 font-sans">
                        <div>
                            <p class="font-bold text-lg text-white">Affect (Verb)</p>
                            <p>Rule: "Affect" is an action word (a verb). It means "to influence" or "to change" something. Remember: <strong>A</strong>ffect is for <strong>A</strong>ction.</p>
                            <p class="mt-1 text-sm italic"><strong>Example:</strong> "The cold weather <strong>affected</strong> the crops."</p>
                        </div>
                        <div>
                            <p class="font-bold text-lg text-white">Effect (Noun)</p>
                            <p>Rule: "Effect" is a thing (a noun). It is the result or consequence of an action. Remember: "effect" is the <strong>E</strong>nd result.</p>
                            <p class="mt-1 text-sm italic"><strong>Example:</strong> "The cold weather had a negative <strong>effect</strong> on the crops."</p>
                        </div>
                        <div class="border-t border-white/20 pt-3">
                            <p class="font-bold text-white">RAVEN Trick:</p>
                            <p><strong>R</strong>emember, <strong>A</strong>ffect is a <strong>V</strong>erb, <strong>E</strong>ffect is a <strong>N</strong>oun.</p>
                        </div>
                    </div>
                `,
                 "Their vs. There vs. They're": `
                    <h3 class="text-2xl font-bold mb-4">Their vs. There vs. They're</h3>
                    <div class="space-y-4 text-slate-300 font-sans">
                        <div>
                            <p class="font-bold text-lg text-white">Their (Possession)</p>
                            <p>Rule: Shows ownership, that something belongs to a group. It has "heir" in it, and an heir inherits things.</p>
                            <p class="mt-1 text-sm italic"><strong>Example:</strong> "The students left <strong>their</strong> books in the classroom."</p>
                        </div>
                        <div>
                            <p class="font-bold text-lg text-white">There (Place)</p>
                            <p>Rule: Refers to a location or place. It has "here" in it, which helps you remember it's about location.</p>
                            <p class="mt-1 text-sm italic"><strong>Example:</strong> "Please put the box over <strong>there</strong>."</p>
                        </div>
                         <div>
                            <p class="font-bold text-lg text-white">They're (Contraction)</p>
                            <p>Rule: A shortened form of "they are". The apostrophe replaces the letter 'a'.</p>
                            <p class="mt-1 text-sm italic"><strong>Example:</strong> "<strong>They're</strong> going to the park today."</p>
                        </div>
                    </div>
                `,
                "port": `
                    <h3 class="text-2xl font-bold mb-4">Root: 'port'</h3>
                    <div class="space-y-4 text-slate-300 font-sans">
                        <div>
                            <p><strong class="text-white">Origin:</strong> Latin</p>
                            <p><strong class="text-white">Meaning:</strong> "to carry"</p>
                        </div>
                        <p>This root forms words related to carrying something from one place to another.</p>
                        <div>
                            <p class="font-bold text-lg text-white">Examples:</p>
                            <ul class="list-disc list-inside text-sm space-y-1 mt-1">
                                <li><strong>trans'port':</strong> To carry people or goods <em>across</em> a distance.</li>
                                <li><strong>im'port':</strong> To carry goods <em>into</em> a country.</li>
                                <li><strong>ex'port':</strong> To carry goods <em>out of</em> a country.</li>
                                <li><strong>'port'er:</strong> A person who carries luggage.</li>
                                <li><strong>re'port':</strong> To carry information back to someone.</li>
                            </ul>
                        </div>
                    </div>
                `,
                "spect": `
                    <h3 class="text-2xl font-bold mb-4">Root: 'spect'</h3>
                    <div class="space-y-4 text-slate-300 font-sans">
                        <div>
                            <p><strong class="text-white">Origin:</strong> Latin</p>
                            <p><strong class="text-white">Meaning:</strong> "to see" or "to look"</p>
                        </div>
                        <p>This root is used in words related to seeing or observing.</p>
                        <div>
                            <p class="font-bold text-lg text-white">Examples:</p>
                            <ul class="list-disc list-inside text-sm space-y-1 mt-1">
                                <li><strong>in'spect':</strong> To look <em>into</em> something carefully.</li>
                                <li><strong>'spect'acle:</strong> A visually striking performance or display.</li>
                                <li><strong>retro'spect':</strong> To look <em>back</em> on past events.</li>
                                <li><strong>'spect'ator:</strong> A person who watches something.</li>
                                <li><strong>per'spect'ive:</strong> A particular way of looking at something.</li>
                            </ul>
                        </div>
                    </div>
                `,
                "bio": `
                    <h3 class="text-2xl font-bold mb-4">Root: 'bio'</h3>
                    <div class="space-y-4 text-slate-300 font-sans">
                        <div>
                            <p><strong class="text-white">Origin:</strong> Greek</p>
                            <p><strong class="text-white">Meaning:</strong> "life"</p>
                        </div>
                        <p>This root is found in many scientific words related to the study of living things.</p>
                        <div>
                            <p class="font-bold text-lg text-white">Examples:</p>
                            <ul class="list-disc list-inside text-sm space-y-1 mt-1">
                                <li><strong>'bio'logy:</strong> The study of <em>life</em>.</li>
                                <li><strong>'bio'graphy:</strong> The story of a person's <em>life</em>.</li>
                                <li><strong>anti'bio'tic:</strong> A medicine that fights against <em>living</em> bacteria.</li>
                                <li><strong>'bio'sphere:</strong> The parts of the Earth where <em>life</em> exists.</li>
                            </ul>
                        </div>
                    </div>
                `,
                "phon": `
                    <h3 class="text-2xl font-bold mb-4">Root: 'phon'</h3>
                    <div class="space-y-4 text-slate-300 font-sans">
                        <div>
                            <p><strong class="text-white">Origin:</strong> Greek</p>
                            <p><strong class="text-white">Meaning:</strong> "sound"</p>
                        </div>
                        <p>This root is used in words related to sound and hearing.</p>
                        <div>
                            <p class="font-bold text-lg text-white">Examples:</p>
                            <ul class="list-disc list-inside text-sm space-y-1 mt-1">
                                <li><strong>tele'phon'e:</strong> A device to hear <em>sound</em> from far away.</li>
                                <li><strong>sym'phon'y:</strong> A complex piece of music with many <em>sounds</em> together.</li>
                                <li><strong>'phon'ics:</strong> A method of teaching reading based on letter <em>sounds</em>.</li>
                                <li><strong>mega'phon'e:</strong> A device to make your voice <em>sound</em> louder.</li>
                            </ul>
                        </div>
                    </div>
                `
            };
            const vocabularyData = {
                 "Study Hall": {
                    "Parts of Speech": {
                        "title": "Parts of Speech",
                        "subtitle": "The fundamental building blocks of English sentences.",
                        "subtopics": {
                            "Noun": {
                                "title": "Noun",
                                "subtitle": "A word that names a person, place, thing, or idea.",
                                "content": [
                                    { "type": "paragraph", "text": "This part of a speech refers to words that are used to name persons, things, animals, places, ideas, or events. Nouns are the simplest among the 8 parts of speech, which is why they are the first ones taught to students in primary school." },
                                    { "type": "example", "text": "<p><strong>Tom Hanks</strong> is very versatile. (<em>names a person</em>)<br><strong>Dogs</strong> can be extremely cute. (<em>names an animal</em>)<br>It is my <strong>birthday</strong>. (<em>names an event</em>)</p>" },
                                    { "type": "heading", "text": "Types of Nouns" },
                                    { "type": "subheading", "text": "Proper Noun" },
                                    { "type": "paragraph", "text": "Proper nouns always start with a capital letter and refer to specific names of persons, places, or things." },
                                    { "type": "example", "text": "<p>Volkswagen Beetle, Shakey’s Pizza, Game of Thrones</p>" },
                                    { "type": "subheading", "text": "Common Noun" },
                                    { "type": "paragraph", "text": "Common nouns are the opposite of proper nouns. These are just generic names of persons, things, or places." },
                                    { "type": "example", "text": "<p>car, pizza parlor, TV series</p>" },
                                    { "type": "subheading", "text": "Concrete Noun" },
                                    { "type": "paragraph", "text": "This kind refers to nouns which you can perceive through your five senses." },
                                    { "type": "example", "text": "<p>folder, sand, board</p>" },
                                    { "type": "subheading", "text": "Abstract Noun" },
                                    { "type": "paragraph", "text": "Unlike concrete nouns, abstract nouns are those which you can’t perceive through your five senses." },
                                    { "type": "example", "text": "<p>happiness, grudge, bravery</p>" },
                                    { "type": "subheading", "text": "Count Noun" },
                                    { "type": "paragraph", "text": "It refers to anything that is countable, and has a singular and plural form." },
                                    { "type": "example", "text": "<p>kitten, video, ball</p>" },
                                    { "type": "subheading", "text": "Mass Noun" },
                                    { "type": "paragraph", "text": "This is the opposite of count nouns. Mass nouns are also called non-countable nouns, and they need to have “counters” to quantify them." },
                                    { "type": "example", "text": "<p><strong>Counters:</strong> kilo, cup, meter<br><strong>Mass Nouns:</strong> rice, flour, garter</p>" },
                                    { "type": "subheading", "text": "Collective Noun" },
                                    { "type": "paragraph", "text": "Refers to a group of persons, animals, or things." },
                                    { "type": "example", "text": "<p>faculty (group of teachers), class (group of students), pride (group of lions)</p>" },
                                    { "type": "practice_quiz", "title": "Noun Practice", "questions": [
                                        { "question": "Which of the following is an Abstract Noun?", "options": ["Book", "Happiness", "Water", "Chair"], "correct_answer": "Happiness" },
                                        { "question": "Identify the Proper Noun in the sentence: 'Rohan went to Delhi.'", "options": ["went", "to", "Rohan", "sentence"], "correct_answer": "Rohan" },
                                        { "question": "Which is a collective noun?", "options": ["Player", "Audience", "Star", "Car"], "correct_answer": "Audience" }
                                    ]}
                                ]
                            },
                            "Pronoun": {
                                "title": "Pronoun",
                                "subtitle": "A word that is used in place of a noun.",
                                "content": [
                                    { "type": "paragraph", "text": "A pronoun is a part of a speech which functions as a replacement for a noun." },
                                    { "type": "example", "text": "<p>Janice is a very stubborn child. <strong>She</strong> just stared at me when I told her to stop.<br>The largest slice is <strong>mine</strong>.<br><strong>We</strong> are number one.</p>" },
                                    { "type": "practice_quiz", "title": "Pronoun Practice", "questions": [
                                        { "question": "In 'Priya loves her new scooter', which word is the pronoun?", "options": ["Priya", "loves", "her", "scooter"], "correct_answer": "her" },
                                        { "question": "Which pronoun would replace 'the students' in 'The students did their homework.'?", "options": ["He", "She", "It", "They"], "correct_answer": "They" }
                                    ]}
                                ]
                            },
                            "Verb": {
                                "title": "Verb",
                                "subtitle": "A word that expresses an action or a state of being.",
                                "content": [
                                    { "type": "paragraph", "text": "A verb is a word that shows an action (physical or mental) or state of being of the subject in a sentence. It is the most important part of a speech, for without a verb, a sentence would not exist." },
                                    { "type": "example", "text": "<p>As usual, the Stormtroopers <strong>missed</strong> their shot.<br>They <strong>are</strong> always prepared in emergencies.</p>" },
                                     { "type": "practice_quiz", "title": "Verb Practice", "questions": [
                                        { "question": "Which word is the action verb in 'The children play in the park'?", "options": ["The", "children", "play", "park"], "correct_answer": "play" },
                                        { "question": "Identify the linking verb: 'The soup smells delicious.'", "options": ["soup", "The", "smells", "delicious"], "correct_answer": "smells" }
                                     ]}
                                ]
                            },
                             "Adjective": {
                                "title": "Adjective",
                                "subtitle": "A word that describes a noun or pronoun.",
                                "content": [
                                    { "type": "paragraph", "text": "An adjective is a part of speech that describes a noun or a pronoun. It can specify the quality, size, and number of nouns or pronouns." },
                                    { "type": "example", "text": "<p>The carvings are <strong>intricate</strong>.<br>I have <strong>two</strong> hamsters.<br>Wow! That doughnut is <strong>huge</strong>!</p>" },
                                     { "type": "practice_quiz", "title": "Adjective Practice", "questions": [
                                        { "question": "Identify the adjective in 'She wore a beautiful saree.'", "options": ["She", "wore", "beautiful", "saree"], "correct_answer": "beautiful" },
                                        { "question": "Which word describes the noun in 'He is a brave soldier.'?", "options": ["He", "is", "a", "brave"], "correct_answer": "brave" }
                                     ]}
                                ]
                            },
                            "Adverb": {
                                "title": "Adverb",
                                "subtitle": "A word that modifies a verb, adjective, or another adverb.",
                                "content": [
                                    { "type": "paragraph", "text": "An adverb is a part of speech that describes a verb, an adjective, or another adverb." },
                                     { "type": "list", "items": [
                                        "<strong>Adverb of Manner:</strong> This describes how an action is done. e.g., 'Annie danced <strong>gracefully</strong>.'",
                                        "<strong>Adverb of Time:</strong> This indicates when something happens. e.g., 'She came <strong>yesterday</strong>.'",
                                        "<strong>Adverb of Place:</strong> This indicates where an action occurs. e.g., 'I looked <strong>everywhere</strong>!'",
                                        "<strong>Adverb of Degree:</strong> This describes the intensity of something. e.g., 'The child is <strong>very</strong> talented.'"
                                    ]},
                                    { "type": "practice_quiz", "title": "Adverb Practice", "questions": [
                                        { "question": "Which word is the adverb in 'The train arrived early'?", "options": ["train", "The", "arrived", "early"], "correct_answer": "early" },
                                        { "question": "Identify the adverb that modifies an adjective in 'It was an extremely difficult test.'", "options": ["was", "an", "extremely", "test"], "correct_answer": "extremely" }
                                    ]}
                                ]
                            },
                            "Preposition": {
                                "title": "Preposition",
                                "subtitle": "A word that shows a relationship between words.",
                                "content": [
                                    { "type": "paragraph", "text": "A preposition is a part of speech that refers to words that specify location or a location in time. Examples include: above, below, throughout, outside, before, near, and since." },
                                    { "type": "example", "text": "<p>Micah is hiding <strong>under</strong> the bed.<br><strong>During</strong> the game, the audience never stopped cheering for their team.</p>" },
                                    { "type": "practice_quiz", "title": "Preposition Practice", "questions": [
                                        { "question": "Find the preposition in 'The book is on the desk.'", "options": ["book", "is", "on", "desk"], "correct_answer": "on" },
                                        { "question": "Which word shows a relationship in 'She walked through the door.'?", "options": ["She", "walked", "through", "door"], "correct_answer": "through" }
                                    ]}
                                ]
                            },
                            "Conjunction": {
                                "title": "Conjunction",
                                "subtitle": "A word that joins words, phrases, or clauses.",
                                "content": [
                                    { "type": "paragraph", "text": "A conjunction is a part of speech that joins words, phrases, or clauses together. Examples are: and, yet, but, for, nor, or, and so." },
                                    { "type": "example", "text": "<p>This cup of tea is delicious <strong>and</strong> very soothing.<br>Kiyoko has to start all over again <strong>because</strong> she didn't follow the professor's instructions.</p>" },
                                    { "type": "practice_quiz", "title": "Conjunction Practice", "questions": [
                                        { "question": "Which is the conjunction in 'He is clever but lazy'?", "options": ["He", "is", "clever", "but"], "correct_answer": "but" },
                                        { "question": "Find the conjunction in 'I will wait until you finish.'", "options": ["I", "will", "wait", "until"], "correct_answer": "until" }
                                    ]}
                                ]
                            },
                            "Interjection": {
                                "title": "Interjection",
                                "subtitle": "A word that expresses strong emotion.",
                                "content": [
                                    { "type": "paragraph", "text": "An interjection is a part of speech that expresses emotions. Interjections are often used to convey strong emotions and are typically followed by an exclamation point." },
                                    { "type": "example", "text": "<p><strong>Ouch!</strong> That must have hurt.<br><strong>Hurray,</strong> we won!</p>" },
                                    { "type": "practice_quiz", "title": "Interjection Practice", "questions": [
                                        { "question": "Which of these words is an interjection?", "options": ["Run", "Quickly", "Alas", "The"], "correct_answer": "Alas" },
                                        { "question": "Identify the interjection in 'Hey! What are you doing?'", "options": ["Hey", "What", "are", "you"], "correct_answer": "Hey" }
                                    ]}
                                ]
                            }
                        }
                    },
                    "Sentence Structure": {
                        "title": "Sentence Structure",
                        "subtitle": "The six fundamental sentence forms.",
                        "content": [
                            { "type": "heading", "text": "The Basic Building Blocks" },
                            { "type": "paragraph", "text": "Every complete sentence contains a subject (who/what the sentence is about) and a verb (the action or state of being)." },
                            { "type": "heading", "text": "The Six Sentence Forms" },
                            { "type": "paragraph", "text": "Sentences can be structured in six primary ways to make statements, ask questions, and express negation. Let's see how a simple statement 'He is sleeping' can be transformed." },
                            { "type": "comparison", "data": {
                                "headers": ["Form", "Structure", "Example"],
                                "rows": [
                                    ["1. Affirmative", "Subject + HV + Main Verb + Object", "He is sleeping."],
                                    ["2. Negative", "Subject + HV + not + Main Verb + Object", "He is not sleeping."],
                                    ["3. Interrogative", "HV + Subject + Main Verb + Object?", "Is he sleeping?"],
                                    ["4. Interrogative-Negative", "HV + Subject + not + Main Verb + Object?", "Is he not sleeping?"],
                                    ["5. Double Interrogative", "Wh-word + HV + Subject + Main Verb + Object?", "Why is he sleeping?"],
                                    ["6. Double Interrogative-Negative", "Wh-word + HV + Subject + not + Main Verb + Object?", "Why is he not sleeping?"]
                                ]
                            }},
                            {
                                "type": "jumbled_quiz",
                                "title": "Sentence Scramble",
                                "questions": [
                                    { "jumbled": ["the", "sings", "a", "girl", "song"], "correct": "The girl sings a song." },
                                    { "jumbled": ["not", "homework", "his", "did", "He", "do"], "correct": "He did not do his homework." },
                                    { "jumbled": ["you", "Are", "to", "market", "the", "going"], "correct": "Are you going to the market?" },
                                    { "jumbled": ["not", "finished", "you", "Have", "yet"], "correct": "Have you not finished yet?" },
                                    { "jumbled": ["you", "were", "Where", "yesterday"], "correct": "Where were you yesterday?" },
                                    { "jumbled": ["not", "you", "Why", "coming", "are"], "correct": "Why are you not coming?" }
                                ]
                            }
                        ]
                    },
                    "Tenses": {
                        "title": "Understanding Tenses",
                        "subtitle": "Expressing when an action takes place.",
                        "content": [
                            { "type": "heading", "text": "Simple Tenses" },
                            { "type": "paragraph", "text": "Simple tenses describe actions without specifying if they are completed or ongoing." },
                            { "type": "comparison", "data": {
                                "headers": ["Tense", "Use", "Example"],
                                "rows": [
                                    ["Simple Present", "Habits, facts, regular actions", "He plays football every day."],
                                    ["Simple Past", "Completed actions in the past", "He played football yesterday."],
                                    ["Simple Future", "Actions that will happen", "He will play football tomorrow."]
                                ]
                            }},
                            { "type": "heading", "text": "Continuous (Progressive) Tenses" },
                            { "type": "paragraph", "text": "Continuous tenses describe ongoing actions." },
                             { "type": "comparison", "data": {
                                "headers": ["Tense", "Use", "Example"],
                                "rows": [
                                    ["Present Continuous", "Actions happening now", "He is playing football right now."],
                                    ["Past Continuous", "Ongoing actions in the past", "He was playing football when I called."],
                                    ["Future Continuous", "Ongoing actions in the future", "He will be playing football at this time tomorrow."]
                                ]
                            }},
                            { "type": "heading", "text": "Perfect Tenses" },
                            { "type": "paragraph", "text": "Perfect tenses describe completed actions, often in relation to another point in time." },
                             { "type": "comparison", "data": {
                                "headers": ["Tense", "Use", "Example"],
                                "rows": [
                                    ["Present Perfect", "Actions completed recently or with relevance to the present", "He has just played football."],
                                    ["Past Perfect", "An action completed before another past action", "He had played football before he went home."],
                                    ["Future Perfect", "An action that will be completed by a certain time in the future", "He will have played football by 6 PM."]
                                ]
                            }},
                            { "type": "heading", "text": "Perfect Continuous Tenses" },
                            { "type": "paragraph", "text": "Perfect continuous tenses describe actions that were in progress over a period of time." },
                             { "type": "comparison", "data": {
                                "headers": ["Tense", "Use", "Example"],
                                "rows": [
                                    ["Present Perfect Continuous", "An action that started in the past and is still continuing", "He has been playing football for two hours."],
                                    ["Past Perfect Continuous", "An action that was ongoing before another past action occurred", "He had been playing football before it started to rain."],
                                    ["Future Perfect Continuous", "An ongoing action that will be completed at a specified time in the future", "By next year, he will have been playing football for a decade."]
                                ]
                            }}
                        ]
                    },
                    "Subject-Verb Agreement": {
                        "title": "Subject-Verb Agreement",
                        "subtitle": "Making subjects and verbs match in number.",
                        "content": [
                            { "type": "heading", "text": "The Basic Rule" },
                            { "type": "paragraph", "text": "A singular subject takes a singular verb, while a plural subject takes a plural verb." },
                            { "type": "example", "text": "<p><strong>Singular:</strong> The <strong>dog barks</strong>.<br><strong>Plural:</strong> The <strong>dogs bark</strong>.</p>" },
                            { "type": "heading", "text": "Key Rules to Remember" },
                            { "type": "list", "items": [
                                "<strong>Compound Subjects:</strong> Subjects joined by 'and' are usually plural. <em>(e.g., 'Rohan and Priya <strong>are</strong> friends.')</em>",
                                "<strong>Subjects Joined by Or/Nor:</strong> The verb agrees with the subject closer to it. <em>(e.g., 'Neither the students nor the teacher <strong>is</strong> happy.')</em>",
                                "<strong>Indefinite Pronouns:</strong> Pronouns like 'each', 'everyone', 'anybody' are singular. <em>(e.g., '<strong>Everyone wants</strong> to win.')</em>",
                                "<strong>Collective Nouns:</strong> Nouns like 'team', 'family', 'group' can be singular or plural, depending on whether they act as a single unit or as individuals. <em>(e.g., 'The <strong>team is</strong> winning.' vs 'The <strong>team are</strong> arguing.')</em>"
                            ]}
                        ]
                    },
                    "Articles & Determiners": {
                        "title": "Articles & Determiners",
                        "subtitle": "Specifying and identifying nouns.",
                        "content": [
                             { "type": "heading", "text": "What are Articles?" },
                             { "type": "paragraph", "text": "Articles are a type of determiner that specify the grammatical definiteness of a noun." },
                             { "type": "comparison", "data": {
                                "headers": ["Article", "Use", "Example"],
                                "rows": [
                                    ["A", "Before a singular noun beginning with a consonant sound.", "a book, a university"],
                                    ["An", "Before a singular noun beginning with a vowel sound.", "an apple, an hour"],
                                    ["The", "To refer to a specific or particular noun.", "The sun is bright. The book on the table is mine."]
                                ]
                            }},
                             { "type": "heading", "text": "Other Determiners" },
                             { "type": "paragraph", "text": "Determiners are words placed before a noun to clarify what the noun refers to." },
                             { "type": "list", "items": [
                                "<strong>Demonstratives:</strong> this, that, these, those. <em>(e.g., '<strong>This</strong> apple is red.')</em>",
                                "<strong>Possessives:</strong> my, your, his, her, its, our, their. <em>(e.g., '<strong>My</strong> car is new.')</em>",
                                "<strong>Quantifiers:</strong> some, any, much, many, a few, a lot of. <em>(e.g., 'There are <strong>many</strong> students.')</em>"
                             ]}
                        ]
                    },
                    "Active & Passive Voice": {
                        "title": "Active & Passive Voice",
                        "subtitle": "Changing the focus of a sentence.",
                        "content": [
                            { "type": "heading", "text": "What is Voice?" },
                            { "type": "paragraph", "text": "Voice describes the relationship between the action (the verb) and the participants (the subject and object). The two main voices are active and passive." },
                            { "type": "subheading", "text": "Active Voice" },
                            { "type": "paragraph", "text": "In the active voice, the subject of the sentence performs the action. Most sentences are written in this voice as it is direct and clear." },
                            { "type": "example", "text": "<p>Structure: Subject + Verb + Object<br>Example: <strong>Rohan</strong> wrote the letter.</p>" },
                            { "type": "subheading", "text": "Passive Voice" },
                            { "type": "paragraph", "text": "In the passive voice, the subject receives the action. The focus shifts from who did the action to what the action was done to." },
                            { "type": "example", "text": "<p>Structure: Object + Helping Verb + Past Participle + by + Subject<br>Example: The <strong>letter</strong> was written by Rohan.</p>" },
                            { "type": "heading", "text": "When to Use the Passive Voice" },
                             { "type": "list", "items": [
                                "When the actor is unknown: 'My car <strong>was stolen</strong>.'",
                                "When the actor is unimportant: 'The bridge <strong>was built</strong> in 1998.'",
                                "To be more formal or polite: 'An error <strong>was made</strong>.'"
                             ]}
                        ]
                    },
                    "Modals": {
                        "title": "Modals",
                        "subtitle": "Verbs for ability, possibility, and obligation.",
                        "content": [
                            { "type": "paragraph", "text": "Modals (or modal auxiliary verbs) are helping verbs used to express ability, permission, possibility, necessity, or advice. They are always followed by the base form of the main verb." },
                            { "type": "comparison", "data": {
                                "headers": ["Modal", "Primary Use", "Example"],
                                "rows": [
                                    ["Can", "Ability, permission", "I <strong>can</strong> speak English."],
                                    ["Could", "Past ability, polite request", "I <strong>could</strong> swim when I was young."],
                                    ["May", "Permission, possibility", "<strong>May</strong> I come in?"],
                                    ["Might", "Possibility (less certain)", "It <strong>might</strong> rain today."],
                                    ["Will", "Future intention, promise", "I <strong>will</strong> call you tomorrow."],
                                    ["Would", "Polite request, hypothetical", "<strong>Would</strong> you help me?"],
                                    ["Shall", "Suggestion, formal future", "<strong>Shall</strong> we begin?"],
                                    ["Should", "Advice, recommendation", "You <strong>should</strong> see a doctor."],
                                    ["Must", "Obligation, necessity", "You <strong>must</strong> finish your homework."]
                                ]
                            }}
                        ]
                    },
                     "Punctuation": {
                        "title": "Punctuation",
                        "subtitle": "The signs and symbols of writing.",
                        "content": [
                            { "type": "paragraph", "text": "Punctuation helps to structure sentences and make their meaning clear." },
                            { "type": "heading", "text": "Common Punctuation Marks" },
                            { "type": "subheading", "text": "1. Period (.)" },
                            { "type": "paragraph", "text": "Used at the end of a declarative sentence (a statement)." },
                            { "type": "example", "text": "<p>The sky is blue<strong>.</strong></p>" },
                            { "type": "subheading", "text": "2. Comma (,)" },
                            { "type": "paragraph", "text": "Used to separate items in a list, separate clauses, and after introductory phrases." },
                            { "type": "example", "text": "<p>I need to buy apples<strong>,</strong> bananas<strong>,</strong> and oranges.</p>" },
                            { "type": "subheading", "text": "3. Question Mark (?)" },
                            { "type": "paragraph", "text": "Used at the end of a direct question." },
                            { "type": "example", "text": "<p>What is your name<strong>?</strong></p>" },
                            { "type": "subheading", "text": "4. Exclamation Mark (!)" },
                            { "type": "paragraph", "text": "Used to express strong emotion or emphasis." },
                            { "type": "example", "text": "<p>That's amazing<strong>!</strong></p>" },
                            { "type": "subheading", "text": "5. Quotation Marks ( \" \" )" },
                            { "type": "paragraph", "text": "Used to enclose direct speech or to indicate a title." },
                            { "type": "example", "text": "<p>She said, <strong>\"</strong>Let's go.<strong>\"</strong></p>" }
                        ]
                    }
                },
                 "Basic Vocabulary": [
                    {"word":"INFLATION","meaning":"मह महंगाई","example":"Inflation is a major concern for the economy."},
                    {"word":"BREAK / PLUCK","meaning":"तोड़na","example":"Don't break the stick / Please pluck a flower from the garden."},
                    {"word":"ADULTRATE","meaning":"मिलावट करना","example":"Some vendors adulterate milk with water to increase their profit."},
                    {"word":"REPAIR / MEND","meaning":"सुधारना","example":"He needs to repair his car / Can you help me mend my torn jacket?"},
                    {"word":"APOLOGISE","meaning":"마피 मांगना","example":"You should apologise for your mistake."}
                ],
                "Daily Actions & Verbs": [
                    { "word": "Get up", "meaning": "उठना", "example": "I get up early every morning." },
                    { "word": "Jump", "meaning": "कुदना", "example": "The children love to jump on the trampoline." },
                    { "word": "Wake up", "meaning": "जागना", "example": "What time do you wake up on weekends?" },
                    { "word": "Run", "meaning": "दौड़ना", "example": "We need to run to catch the bus." },
                    { "word": "Take bath", "meaning":"नहाना","example":"I take a bath to relax after work."}
                ],
                "Travel & Adventure": [
                    {"word":"Wanderlust","meaning":"A strong desire to travel (घूमने की तीव्र इच्छा)","example":"Her wanderlust led her to explore remote corners of the world."},
                    {"word":"Itinerary","meaning":"A planned route or journey (यात्रा कार्यक्रम)","example":"We have a packed itinerary for our trip to Italy."},
                    {"word":"Serendipity","meaning":"Finding something good without looking for it (आकस्मिक लाभ)","example":"It was pure serendipity that we found this hidden gem of a restaurant."},
                    {"word":"Navigate","meaning":"To plan and direct the course of a ship, aircraft, or other form of transport (मार्गदर्शन करना)","example":"He learned to navigate using the stars."},
                    {"word":"Excursion","meaning":"A short journey or trip (सैर)","example":"We went on a brief excursion to the nearby mountains."}
                ],
                 "Food & Cooking": [
                    {"word":"Saute","meaning":"To fry quickly in a little hot fat (हलका तलना)","example":"Sauté the onions until they are golden brown."},
                    {"word":"Blanch","meaning":"To scald briefly and then plunge into cold water (उबालकर ठंडा करना)","example":"Blanch the almonds to remove their skins easily."},
                    {"word":"Garnish","meaning":"To decorate or embellish a food dish (सजाना)","example":"She garnished the soup with a sprig of parsley."},
                    {"word":"Zest","meaning":"The outer colored part of the peel of citrus fruit (नींबूवर्गीय फल का छिलка)","example":"Add the lemon zest to the batter for extra flavor."},
                    {"word":"Knead","meaning":"To work dough or clay into a uniform mixture (गूंधना)","example":"You need to knead the dough for at least ten minutes."}
                ],
                 "Emotions & Feelings": [
                    {"word":"Elation","meaning":"Great happiness and exhilaration (उल्लास)","example":"She felt a sense of elation after finishing the marathon."},
                    {"word":"Melancholy","meaning":"A feeling of pensive sadness, typically with no obvious cause (उदासी)","example":"A feeling of melancholy washed over him as he listened to the old song."},
                    {"word":"Ambivalence","meaning":"The state of having mixed feelings about something (उभयभाविता)","example":"He felt a certain ambivalence towards his new job."},
                    {"word":"Nostalgia","meaning":"A sentimental longing for the past (अतीत की याद)","example":"Looking at old photos filled her with a deep sense of nostalgia."},
                    {"word":"Apprehension","meaning":"Anxiety or fear that something bad will happen (आशंका)","example":"She felt a wave of apprehension as she waited for her exam results."}
                ],
                "Confusing Words": [
                    { title: "Affect vs. Effect", type: 'explanation' },
                    { title: "Their vs. There vs. They're", type: 'explanation' }
                ],
                "Word Roots (Etymology)": {
                    "Latin Roots": [
                        { title: "port", meaning: "to carry", type: 'root' },
                        { title: "spect", meaning: "to see", type: 'root' }
                    ],
                    "Greek Roots": [
                        { title: "bio", meaning: "life", type: 'root' },
                        { title: "phon", meaning: "sound", type: 'root' }
                    ]
                },
                "Phrases & Idioms": {
                    "Body Parts Idioms": [
                        {"word":"Be all ears","meaning":"Listen attentively","example":"Tell me your story - I'm all ears."},
                        {"word":"Be at each other’s throats","meaning":"Constantly fighting","example":"My siblings were at each other's throats the entire holiday."},
                        {"word":"Have your back to the wall","meaning":"Be in a desperate situation","example":"With his funds cut off, he had his back to the wall."},
                        {"word":"Talk behind someone’s back","meaning":"Speak secretly about someone","example":"I hate it when I hear people talking behind my back."},
                        {"word":"Break a leg","meaning":"Wish good luck","example":"'Break a leg!' she shouted to the actors before the play."}
                    ],
                    "Nature & Environment": [
                        {"word":"Every cloud has a silver lining","meaning":"Good comes after bad","example":"I lost my job, but the silver lining is I have more time for family."},
                        {"word":"Steal someone’s thunder","meaning":"Take credit for another’s idea","example":"She announced my news before I could, completely stealing my thunder."},
                        {"word":"Under the weather","meaning":"Feeling ill","example":"I'm feeling a bit under the weather today, so I'm staying home."},
                        {"word":"Come rain or shine","meaning":"No matter the circumstances","example":"I'll be at your game, come rain or shine."},
                        {"word":"Storm in a teacup","meaning":"Big fuss over nothing","example":"Their argument was just a storm in a teacup; they're friends again now."}
                    ],
                    "Animal Idioms": [
                        { "word": "Let the cat out of the bag", "meaning": "Reveal a secret", "example": "He let the cat out of the bag about the surprise party." },
                        { "word": "The lion’s share", "meaning": "The largest portion", "example": "The oldest sibling always gets the lion's share of the cake." },
                        { "word": "Take the bull by the horns", "meaning": "Face a problem directly", "example": "She decided to take the bull by the horns and confront her boss." },
                        { "word": "Cry wolf", "meaning": "Raise a false alarm", "example": "If you keep crying wolf, no one will believe you when there's a real problem." },
                        { "word": "Beat a dead horse", "meaning": "Waste effort on a lost cause", "example":"There's no point in arguing further; you're just beating a dead horse." }
                    ],
                    "Common Idiomatic Expressions": [
                        {"word":"Bite the bullet","meaning":"To endure a difficult situation with courage","example":"He had to bite the bullet and work extra hours to finish the project."},
                        {"word":"Hit the sack","meaning":"To go to bed","example":"I'm really tired, I think it's time to hit the sack."},
                        {"word":"Spill the beans","meaning":"To reveal a secret","example":"Come on, spill the beans! What did he say?"},
                        {"word":"Once in a blue moon","meaning":"Happens very rarely","example":"I only see my cousins from Australia once in a blue moon."},
                        {"word":"The ball is in your court","meaning":"It's your turn to make a decision or take the next step","example":"I've done all I can, now the ball is in your court."}
                    ]
                },
                "Synonyms": {
                    "A":[{"word":"Aberration","meaning":"असामान्य","synonyms":["Deviation","Anomaly","Irregularity"]},{"word":"Abhor","meaning":"घृणा करना","synonyms":["Detest","Loathe","Hate"]}],
                    "B":[{"word":"Bellicose","meaning":"लड़ाकू","synonyms":["Belligerent","Aggressive","Hostile"]},{"word":"Benevolent","meaning":"परोपकारी","synonyms":["Kind","Charitable","Generous"]}],
                    "C":[{"word":"Cacophony","meaning":"शोरगुल","synonyms":["Dissonance","Discord","Din"]},{"word":"Capricious","meaning":"मनमौजी","synonyms":["Fickle","Inconstant","Mercurial"]}],
                    "D":[{"word":"Deference","meaning":"सम्मान","synonyms":["Respect","Regard","Esteem"]},{"word":"Diligent","meaning":"मेहनती","synonyms":["Industrious","Assiduous","Hardworking"]}],
                    "E":[{"word":"Ebullient","meaning":"उत्साही","synonyms":["Exuberant","Buoyant","Cheerful"]},{"word":"Ephemeral","meaning":"अल्पकालिक","synonyms":["Transient","Fleeting","Short-lived"]}],
                    "F":[{"word":"Fastidious","meaning":"नख़रेबाज़","synonyms":["Meticulous","Scrupulous","Painstaking"]},{"word":"Furtive","meaning":"गुप्त","synonyms":["Stealthy","Covert","Surreptitious"]}],
                    "G":[{"word":"Gregarious","meaning":"मिलनसार","synonyms":["Sociable","Companionable","Outgoing"]},{"word":"Garrulous","meaning":"बातूनी","synonyms":["Talkative","Loquacious","Verbose"]}],
                    "H":[{"word":"Hapless","meaning":"अभागा","synonyms":["Unlucky","Unfortunate","Cursed"]},{"word":"Haughty","meaning":"घमंडी","synonyms":["Arrogant","Proud","Vain"]}],
                    "I":[{"word":"Immutable","meaning":"अपरिवर्तनीय","synonyms":["Unchangeable","Fixed","Permanent"]},{"word":"Incessant","meaning":"लगातार","synonyms":["Ceaseless","Constant","Unending"]}],
                    "J":[{"word":"Juxtaposition","meaning":"समीपवर्तिता","synonyms":["Proximity","Adjacency","Contiguity"]},{"word":"Jovial","meaning":"हंसमुख","synonyms":["Cheerful","Merry","Good-humored"]}],
                    "K":[{"word":"Keen","meaning":"उत्सुक","synonyms":["Eager","Sharp","Enthusiastic"]},{"word":"Knell","meaning":"मृत्यु-सूचना","synonyms":["Chime","Toll","Ring"]}],
                    "L":[{"word":"Laconic","meaning":"संक्षिप्त","synonyms":["Brief","Concise","Terse"]},{"word":"Languid","meaning":"सुस्त","synonyms":["Listless","Lethargic","Sluggish"]}],
                    "M":[{"word":"Malleable","meaning":"लचीला","synonyms":["Pliable","Ductile","Supple"]},{"word":"Maverick","meaning":"आवारा","synonyms":["Nonconformist","Individualist","Rebel"]}],
                    "N":[{"word":"Nefarious","meaning":"कुटिल","synonyms":["Wicked","Evil","Sinful"]},{"word":"Nostalgia","meaning":"उदासी","synonyms":["Wistfulness","Longing","Reminiscence"]}],
                    "O":[{"word":"Obstinate","meaning":"ज़िद्दी","synonyms":["Stubborn","Adamant","Unyielding"]},{"word":"Opaque","meaning":"अपारदर्शी","synonyms":["Nontransparent","Cloudy","Blurred"]}],
                    "P":[{"word":"Pernicious","meaning":"हानिकारक","synonyms":["Harmful","Destructive","Damaging"]},{"word":"Parsimonious","meaning":"कंजूस","synonyms":["Miserly","Stingy","Frugal"]}],
                    "Q":[{"word":"Querulous","meaning":"झगड़ालू","synonyms":["Petulant","Complaining","Fretful"]},{"word":"Quixotic","meaning":"अव्यावहारिक","synonyms":["Idealistic","Impractical","Visionary"]}],
                    "R":[{"word":"Rancor","meaning":"द्वेष","synonyms":["Bitterness","Spite","Animosity"]},{"word":"Resilient","meaning":"लचीला","synonyms":["Strong","Tough","Hardy"]}],
                    "S":[{"word":"Sagacity","meaning":"बुद्धिमानी","synonyms":["Wisdom","Insight","Discernment"]},{"word":"Superfluous","meaning":"अतिरिक्त","synonyms":["Unnecessary","Redundant","Excess"]}],
                    "T":[{"word":"Taciturn","meaning":"अल्पभाषी","synonyms":["Reticent","Uncommunicative","Quiet"]},{"word":"Transient","meaning":"क्षणिक","synonyms":["Transitory","Temporary","Fleeting"]}],
                    "U":[{"word":"Ubiquitous","meaning":"सर्वव्यापी","synonyms":["Omnipresent","Everywhere","Pervasive"]},{"word":"Unctuous","meaning":"चापलूसी","synonyms":["Sycophantic","Ingratiating","Obsequious"]}],
                    "V":[{"word":"Venerate","meaning":"सम्मान करना","synonyms":["Revere","Respect","Adore"]},{"word":"Verbose","meaning":"शब्दबहुल","synonyms":["Wordy","Loquacious","Talkative"]}],
                    "W":[{"word":"Wane","meaning":"घटना","synonyms":["Diminish","Decline","Dwindle"]},{"word":"Wary","meaning":"सतर्क","synonyms":["Cautious","Careful","Vigilant"]}],
                    "X":[{"word":"Xenophobia","meaning":"विदेशी द्वेष","synonyms":["Racism","Prejudice","Bigotry"]}],
                    "Y":[{"word":"Yearn","meaning":"तरसना","synonyms":["Crave","Long for","Desire"]}],
                    "Z":[{"word":"Zealot","meaning":"कट्टरपंथी","synonyms":["Fanatic","Extremist","Radical"]},{"word":"Zenith","meaning":"שִׂיא","synonyms":["Peak","Apex","Summit"]}]
                },
                "Antonyms": [
                    { "word": "Abundant", "meaning": "प्रचुर", "antonym": "Scarce", "antonym_meaning": "दुर्लभ" },
                    { "word": "Accept", "meaning": "स्वीकार करना", "antonym": "Refuse", "antonym_meaning": "अस्वीकार करना" },
                    { "word": "Accurate", "meaning": "सटीक", "antonym": "Inaccurate", "antonym_meaning": "गलत" },
                    { "word": "Advantage", "meaning": "लाभ", "antonym": "Disadvantage", "antonym_meaning": "हानि" },
                    { "word": "Admit", "meaning": "स्वीकार करना", "antonym": "Deny", "antonym_meaning": "इनकार करना" },
                    { "word": "Brave", "meaning": "बहादुर", "antonym": "Cowardly", "antonym_meaning": "कायर" },
                    { "word": "Create", "meaning": "बनाना", "antonym": "Destroy", "antonym_meaning": "नष्ट करना" },
                    { "word": "Expand", "meaning": "विस्तार करना", "antonym": "Contract", "antonym_meaning": "सिकोड़ना" },
                    { "word": "Generous", "meaning": "उदार", "antonym": "Stingy", "antonym_meaning": "कंजूस" },
                    { "word": "Joy", "meaning": "आनंद", "antonym": "Sorrow", "antonym_meaning": "दुःख" }
                ],
                "Advanced Vocabulary": {
                    "One Word Substitution": [
                        {"meaning":"To make a situation seem larger", "word":"Exaggerate"},
                        {"meaning":"To criticize someone publicly", "word":"Denounce"},
                        {"meaning":"To hint at something indirectly", "word":"Allude"},
                        {"meaning":"To avoid giving a clear answer", "word":"Equivocate"},
                        {"meaning":"To reduce the severity of something", "word":"Mitigate"}
                    ],
                    "Business Vocab": [
                        {"word":"Leverage","meaning":"To use something to maximum advantage","example":"We can leverage our social media presence to increase sales."},
                        {"word":"Synergy","meaning":"Combined effect greater than the sum of parts","example":"The synergy between the marketing and sales teams led to great success."},
                        {"word":"Benchmark","meaning":"A standard against which things are compared","example":"Our company's performance is a benchmark for the entire industry."},
                        {"word":"Stakeholder","meaning":"A person with an interest in a business","example":"We need to consider all stakeholders before making a decision."},
                        {"word":"ROI","meaning":"Return on Investment","example":"We need to calculate the potential ROI before starting the new project."}
                    ],
                    "Foreign Loanwords": [
                        {"word":"Déjà vu","meaning":"(French) The feeling that one has lived through the present situation before","example":"As she walked into the old house, she experienced a strong sense of déjà vu."},
                        {"word":"Schadenfreude","meaning":"(German) Pleasure derived from another person's misfortune","example":"He couldn't help but feel a twinge of schadenfreude when his rival's project failed."},
                        {"word":"Bona fide","meaning":"(Latin) Genuine; real","example":"He made a bona fide offer to buy the company."},
                        {"word":"RSVP","meaning":"(French: Répondez s'il vous plaît) Please respond","example":"Please RSVP by the end of the week so we can get a headcount."},
                        {"word":"Faux pas","meaning":"(French) An embarrassing or tactless act in a social situation","example":"Wearing white to the wedding was a major faux pas."}
                    ],
                    "Phobias & Manias": [
                        {"word":"Acrophobia","meaning":"Extreme or irrational fear of heights","example":"His acrophobia prevented him from climbing the tall ladder."},
                        {"word":"Bibliomania","meaning":"Passionate enthusiasm for collecting and possessing books","example":"Her bibliomania was evident from the floor-to-ceiling bookshelves in every room."},
                        {"word":"Claustrophobia","meaning":"Extreme or irrational fear of confined places","example":"He suffers from claustrophobia, so he avoids elevators."},
                        {"word":"Arachnophobia","meaning":"Extreme or irrational fear of spiders","example":"She screamed when she saw the tiny spider, a classic sign of her arachnophobia."},
                        {"word":"Megalomania","meaning":"Obsession with the exercise of power","example":"The dictator's megalomania led to his eventual downfall."}
                    ]
                }
            };
            
            // --- Elements ---
            const splashScreen = document.getElementById('splash-screen');
            const appContainer = document.getElementById('app-container');
            const categoryView = document.getElementById('category-view');
            const wordView = document.getElementById('word-view');
            const categoryGrid = document.getElementById('category-grid');
            const bottomNav = document.getElementById('bottom-nav');
            const navHomeBtn = document.getElementById('nav-home');
            const navBackBtn = document.getElementById('nav-back');
            const navQuizBtn = document.getElementById('nav-quiz');
            const navFavoritesBtn = document.getElementById('nav-favorites');
            const headerSubtitle = document.getElementById('header-subtitle');
            const searchBar = document.getElementById('search-bar');
            const searchContainer = document.getElementById('search-container');
            const searchSuggestions = document.getElementById('search-suggestions');
            const aboutBtn = document.getElementById('about-btn');
            const aboutModal = document.getElementById('about-modal');
            const closeAboutModal = document.getElementById('close-about-modal');
            const explanationModal = document.getElementById('explanation-modal');
            const closeExplanationModal = document.getElementById('close-explanation-modal');
            const explanationContent = document.getElementById('explanation-content');
            // Profile Elements
            const profileSetupModal = document.getElementById('profile-setup-modal');
            const usernameInput = document.getElementById('username-input');
            const saveProfileBtn = document.getElementById('save-profile-btn');
            const profileBtn = document.getElementById('profile-btn');
            const userProfileModal = document.getElementById('user-profile-modal');
            const userProfileContent = document.getElementById('user-profile-content');
            const closeUserProfileModal = document.getElementById('close-user-profile-modal');


            // --- State ---
            let activeWordItem = null;
            const navStack = [];
            const gradients = ['grad-1', 'grad-2', 'grad-3', 'grad-4', 'grad-5', 'grad-6', 'grad-7'];
            let currentWordListData = { title: null, words: [] };
            let favorites = [];
            let allWords = [];
            let allCategoriesMap = new Map();
            const originalSynonymsData = vocabularyData["Synonyms"];
            let synthVoices = [];
            let userProfile = null;
            
            // --- Functions ---
            
            // --- Profile Functions ---
            function loadProfile() {
                const savedProfile = localStorage.getItem('lingoProfile');
                if (savedProfile) {
                    userProfile = JSON.parse(savedProfile);
                    // Check streak on load
                    updateStreak(false); // don't increment, just check if it's broken
                    profileBtn.classList.remove('hidden');
                    return true;
                }
                return false;
            }

            function saveProfile(profile) {
                userProfile = profile;
                localStorage.setItem('lingoProfile', JSON.stringify(userProfile));
            }
            
            function isSameDay(date1, date2) {
                if (!date1 || !date2) return false;
                const d1 = new Date(date1);
                const d2 = new Date(date2);
                return d1.getFullYear() === d2.getFullYear() &&
                       d1.getMonth() === d2.getMonth() &&
                       d1.getDate() === d2.getDate();
            }

            function isYesterday(date1, date2) {
                 if (!date1 || !date2) return false;
                const yesterday = new Date(date2);
                yesterday.setDate(yesterday.getDate() - 1);
                return isSameDay(date1, yesterday);
            }

            function updateStreak(increment = true) {
                if (!userProfile) return;

                const now = new Date();
                const lastQuizDate = userProfile.lastQuizDate ? new Date(userProfile.lastQuizDate) : null;
                
                if (increment) {
                    if (lastQuizDate && isYesterday(lastQuizDate, now)) {
                        userProfile.streak = (userProfile.streak || 0) + 1;
                    } else if (!lastQuizDate || !isSameDay(lastQuizDate, now)) {
                         userProfile.streak = 1;
                    }
                    userProfile.lastQuizDate = now.toISOString();
                } else { // Just check if streak is broken
                    if (lastQuizDate && !isSameDay(lastQuizDate, now) && !isYesterday(lastQuizDate, now)) {
                        userProfile.streak = 0;
                    }
                }
                saveProfile(userProfile);
            }


            function checkProfileFormState() {
                const name = usernameInput.value.trim();
                saveProfileBtn.disabled = !name;
            }

            function showProfileSetup() {
                usernameInput.addEventListener('input', checkProfileFormState);
                profileSetupModal.classList.remove('hidden');
            }

            function saveAndApplyProfile() {
                const name = usernameInput.value.trim();
                const newProfile = { 
                    name, 
                    quizHistory: [],
                    streak: 0,
                    lastQuizDate: null
                };
                
                saveProfile(newProfile);
                profileBtn.classList.remove('hidden');
                profileSetupModal.classList.add('hidden');
                
                // Continue to app
                renderCategories(vocabularyData);
            }
            
            function getFocusArea() {
                if (!userProfile || userProfile.quizHistory.length < 5) {
                    return null; // Not enough data
                }
                
                const categoryScores = userProfile.quizHistory.reduce((acc, result) => {
                    const category = result.title.replace(' Quiz', '');
                    if (!acc[category]) {
                        acc[category] = { totalScore: 0, totalPossible: 0, count: 0 };
                    }
                    acc[category].totalScore += result.score;
                    acc[category].totalPossible += result.total;
                    acc[category].count++;
                    return acc;
                }, {});

                let lowestAvg = 101;
                let focusCategory = null;

                for(const category in categoryScores) {
                    const avg = (categoryScores[category].totalScore / categoryScores[category].totalPossible) * 100;
                    if (avg < lowestAvg) {
                        lowestAvg = avg;
                        focusCategory = category;
                    }
                }

                return focusCategory;
            }
            
            function navigateToCategory(categoryName) {
                const categoryData = allCategoriesMap.get(categoryName);
                if (categoryData) {
                    navStack.push({ renderFunc: renderCategories, args: [vocabularyData, "LingoQuest", "Your daily dose of vocabulary."] });
                    
                    if (typeof categoryData.data === 'function') {
                         categoryData.data(categoryData.gradClass);
                    } else if (Array.isArray(categoryData.data)) {
                        renderWords(categoryName, categoryData.data, false, categoryData.gradClass);
                    } else {
                        renderCategories(categoryData.data, categoryName, "Select a sub-category");
                    }
                    userProfileModal.classList.add('hidden');
                }
            }


            function displayProfileModal() {
                if (!userProfile) return;
                
                // --- Calculate Stats ---
                const totalQuizzes = userProfile.quizHistory.length;
                let totalScore = 0;
                let totalPossibleScore = 0;

                if (totalQuizzes > 0) {
                    userProfile.quizHistory.forEach(result => {
                        totalScore += result.score;
                        totalPossibleScore += result.total;
                    });
                }
                
                const overallAccuracy = totalPossibleScore > 0 ? ((totalScore / totalPossibleScore) * 100).toFixed(0) : 0;
                
                // --- Get Focus Area ---
                const focusArea = getFocusArea();
                let focusAreaHTML;
                if (focusArea) {
                     focusAreaHTML = `
                        <div class="focus-card" data-category="${focusArea}">
                            <h3 class="text-sm font-bold text-slate-300 uppercase">Focus Area</h3>
                            <p class="text-lg font-bold text-white mt-2">${focusArea}</p>
                            <p class="text-xs text-amber-400">Click to practice</p>
                        </div>
                     `;
                } else {
                     focusAreaHTML = `
                        <div class="stat-card">
                            <h3 class="text-sm font-bold text-slate-300 uppercase">Focus Area</h3>
                            <p class="text-xs font-normal text-slate-400 mt-2">Take a few more quizzes to unlock this!</p>
                        </div>
                     `;
                }

                // --- Get Last 5 Test Results ---
                const recentHistoryHTML = userProfile.quizHistory.slice(0, 5).map(r => `
                    <div class="quiz-history-item font-sans">
                        <div>
                            <p class="font-semibold text-white">${r.title}</p>
                            <p class="text-xs text-slate-400">${new Date(r.date).toLocaleDateString()}</p>
                        </div>
                        <p class="font-bold text-lg ${r.score / r.total >= 0.7 ? 'text-green-400' : 'text-amber-400'}">${r.score}/${r.total}</p>
                    </div>
                `).join('');

                userProfileContent.innerHTML = `
                    <div class="text-center mb-6">
                        <p class="text-xs text-slate-400">Welcome back,</p>
                        <h2 class="text-3xl font-bold text-white">${userProfile.name}</h2>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                        <div class="stat-card">
                            <h3 class="text-sm font-bold text-slate-300 uppercase">Streak</h3>
                             <p class="text-3xl font-extrabold text-amber-400 mt-1 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mr-1"><path d="M11.996 1.1a1 1 0 0 0-.915.584l-2.062 4.122a1 1 0 0 1-.741.51l-4.551.652a1 1 0 0 0-.555 1.706l3.293 3.21a1 1 0 0 1 .288.885l-.778 4.533a1 1 0 0 0 1.451 1.054l4.07-2.14a1 1 0 0 1 .932 0l4.07 2.14a1 1 0 0 0 1.451-1.054l-.778-4.533a1 1 0 0 1 .288-.885l3.293-3.21a1 1 0 0 0-.555-1.706l-4.55-.652a1 1 0 0 1-.741-.51l-2.063-4.122A1 1 0 0 0 11.996 1.1zM11.996 1.1a1 1 0 0 0-.915.584l-2.062 4.122a1 1 0 0 1-.741.51l-4.551.652a1 1 0 0 0-.555 1.706l3.293 3.21a1 1 0 0 1 .288.885l-.778 4.533a1 1 0 0 0 1.451 1.054l4.07-2.14a1 1 0 0 1 .932 0l4.07 2.14a1 1 0 0 0 1.451-1.054l-.778-4.533a1 1 0 0 1 .288-.885l3.293-3.21a1 1 0 0 0-.555-1.706l-4.55-.652a1 1 0 0 1-.741-.51l-2.063-4.122A1 1 0 0 0 11.996 1.1z"></path></svg>
                                ${userProfile.streak || 0}
                            </p>
                        </div>
                        <div class="stat-card">
                            <h3 class="text-sm font-bold text-slate-300 uppercase">Accuracy</h3>
                            <p class="text-3xl font-extrabold text-white mt-1">${overallAccuracy}%</p>
                        </div>
                        ${focusAreaHTML}
                    </div>

                    <h3 class="text-xl font-bold text-white mb-2 border-b border-white/20 pb-2">Recent Scores</h3>
                    <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                        ${recentHistoryHTML || '<p class="text-center text-slate-400 font-sans py-4">No quiz history yet. Take a quiz to see your results!</p>'}
                    </div>
                `;
                userProfileModal.classList.remove('hidden');

                const focusCard = userProfileContent.querySelector('.focus-card');
                if (focusCard) {
                    focusCard.addEventListener('click', () => {
                        navigateToCategory(focusCard.dataset.category);
                    });
                }
            }


            function addQuizResult(title, score, total) {
                if (!userProfile) return;
                const result = { title, score, total, date: new Date().toISOString() };
                userProfile.quizHistory = [result, ...userProfile.quizHistory];
                updateStreak(true);
                saveProfile(userProfile);
            }


            function renderCategories(categories, title = "LingoQuest", subtitle = "Your daily dose of vocabulary.") {
                setTimeout(() => { wordView.scrollTop = 0; }, 0); 
                document.body.classList.remove('view-active');
                appContainer.classList.add('p-4');
                categoryGrid.innerHTML = '';
                headerSubtitle.textContent = subtitle;

                let i = 0;
                
                const displayCategories = {...categories};
                
                if (categories === vocabularyData) {
                    if (favorites.length > 0) {
                        displayCategories["Favorites"] = favorites;
                    } else {
                        delete displayCategories["Favorites"];
                    }
                    displayCategories["Dictionary"] = renderDictionary;
                }


                for (const categoryName in displayCategories) {
                    if (Array.isArray(displayCategories[categoryName]) && displayCategories[categoryName].length === 0) continue;
                    if (typeof displayCategories[categoryName] === 'object' && !Array.isArray(displayCategories[categoryName]) && Object.keys(displayCategories[categoryName]).length === 0) continue;

                    const card = document.createElement('div');
                    const isFav = categoryName === 'Favorites';
                    const isDict = categoryName === 'Dictionary';
                    const isStudyHall = categoryName === 'Study Hall';

                    let gradClass = gradients[i % gradients.length];
                    if (isFav) gradClass = 'grad-fav';
                    if (isDict) gradClass = 'grad-5';
                    if (isStudyHall) gradClass = 'grad-7';
                    
                    if(title === "LingoQuest") {
                        allCategoriesMap.set(categoryName, { data: displayCategories[categoryName], gradClass: gradClass });
                    }


                    card.className = `category-card p-4 rounded-2xl flex flex-col justify-center items-center text-center cursor-pointer pop-in ${gradClass}`;
                    card.style.animationDelay = `${i * 60}ms`;
                    
                    card.innerHTML = `
                        <p class="text-white font-bold text-lg">${categoryName}</p>
                    `;
                    
                    card.addEventListener('click', () => {
                        const data = displayCategories[categoryName];
                        navStack.push({ renderFunc: renderCategories, args: [categories, title, subtitle] });
                        
                        if (typeof data === 'function') {
                            data(gradClass);
                        } else if (Array.isArray(data)) {
                            renderWords(categoryName, data, false, gradClass, { isFavorites: isFav });
                        } else if (data.content && Array.isArray(data.content)) { // This is a Study Hall lesson
                            renderStudyHallLesson(data.title, data.subtitle, data.content);
                        } else if (data.subtopics) { // This is a Study Hall category with subtopics
                            renderSubtopicSelection(data.title, data.subtitle, data.subtopics);
                        }
                        else {
                            renderCategories(data, categoryName, "Select a sub-category");
                        }
                    });

                    categoryGrid.appendChild(card);
                    i++;
                }
                
                wordView.classList.add('hidden');
                categoryView.classList.remove('hidden');
                document.getElementById('home-features').classList.remove('hidden');
                
                if (navStack.length === 0) {
                    bottomNav.classList.add('hidden');
                } else {
                    bottomNav.classList.remove('hidden');
                    navQuizBtn.disabled = true;
                }
            }

            function renderSubtopicSelection(title, subtitle, subtopics) {
                wordView.innerHTML = '';
                setTimeout(() => { wordView.scrollTop = 0; }, 0);
                document.body.classList.add('view-active');
                appContainer.classList.remove('p-4');
                wordView.classList.add('active');

                const section = document.createElement('section');
                section.id = "subtopic-section";
                section.className = "pop-in p-4 max-w-3xl mx-auto pb-24";

                const header = document.createElement('div');
                header.className = 'text-center mb-8';
                header.innerHTML = `
                    <h1 class="text-3xl font-bold text-white">${title}</h1>
                    <p class="text-slate-300 mt-1">${subtitle}</p>
                `;
                section.appendChild(header);

                const subtopicGrid = document.createElement('div');
                subtopicGrid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';

                for (const key in subtopics) {
                    const subtopic = subtopics[key];
                    const card = document.createElement('button');
                    card.className = 'mode-card p-4 rounded-xl text-left';
                    card.innerHTML = `
                        <h3 class="font-bold text-lg text-white">${subtopic.title}</h3>
                        <p class="text-sm text-slate-300">${subtopic.subtitle}</p>
                    `;
                    card.addEventListener('click', () => {
                        navStack.push({ renderFunc: renderSubtopicSelection, args: [title, subtitle, subtopics] });
                        renderStudyHallLesson(subtopic.title, subtopic.subtitle, subtopic.content);
                    });
                    subtopicGrid.appendChild(card);
                }

                section.appendChild(subtopicGrid);
                wordView.appendChild(section);

                categoryView.classList.add('hidden');
                wordView.classList.remove('hidden');
                document.getElementById('home-features').classList.add('hidden');
                bottomNav.classList.remove('hidden');
                navQuizBtn.disabled = true;
            }

            function renderStudyHallLesson(title, subtitle, content) {
                wordView.innerHTML = '';
                wordView.classList.remove('flex', 'items-center', 'justify-center');
                setTimeout(() => { wordView.scrollTop = 0; }, 0);
                document.body.classList.add('view-active');
                appContainer.classList.remove('p-4');
                wordView.classList.add('active');

                const section = document.createElement('section');
                section.className = "pop-in p-4 max-w-3xl mx-auto pb-24";
                
                const header = document.createElement('div');
                header.className = 'text-center mb-8';
                header.innerHTML = `
                    <h1 class="text-3xl font-bold text-white">${title}</h1>
                    <p class="text-slate-300 mt-1">${subtitle}</p>
                `;
                section.appendChild(header);

                const contentContainer = document.createElement('div');
                contentContainer.className = 'glass-ui p-6 rounded-2xl lesson-content';

                content.forEach(item => {
                    let element;
                    switch (item.type) {
                        case 'heading':
                            element = document.createElement('h2');
                            element.innerHTML = item.text;
                            break;
                        case 'subheading':
                            element = document.createElement('h3');
                            element.innerHTML = item.text;
                            break;
                        case 'paragraph':
                            element = document.createElement('p');
                            element.innerHTML = item.text;
                            break;
                        case 'example':
                            element = document.createElement('div');
                            element.className = 'example';
                            element.innerHTML = item.text;
                            break;
                        case 'list':
                             element = document.createElement('ul');
                             element.className = 'bullet-list';
                             item.items.forEach(liText => {
                                const li = document.createElement('li');
                                li.innerHTML = liText;
                                element.appendChild(li);
                             });
                             break;
                        case 'comparison':
                            const table = document.createElement('table');
                            table.className = 'comparison-table';
                            const thead = document.createElement('thead');
                            const tbody = document.createElement('tbody');

                            // Create header row
                            const headerTr = document.createElement('tr');
                            item.data.headers.forEach(headerText => {
                                const th = document.createElement('th');
                                th.textContent = headerText;
                                headerTr.appendChild(th);
                            });
                            thead.appendChild(headerTr);

                            // Create body rows
                            item.data.rows.forEach(row => {
                                const bodyTr = document.createElement('tr');
                                row.forEach((cellContent, index) => {
                                    const td = document.createElement('td');
                                    td.innerHTML = cellContent;
                                    td.setAttribute('data-label', item.data.headers[index]);
                                    bodyTr.appendChild(td);
                                });
                                tbody.appendChild(bodyTr);
                            });

                            table.appendChild(thead);
                            table.appendChild(tbody);
                            
                            element = table;
                            break;
                         case 'practice_quiz':
                            element = document.createElement('div');
                            element.className = 'mt-8';
                            const quizId = `practice-${title.replace(/\s+/g, '-').toLowerCase()}`;
                            const startQuizBtn = document.createElement('button');
                            startQuizBtn.className = 'mode-card grad-nav text-white font-bold p-4 rounded-xl w-full text-center';
                            startQuizBtn.innerHTML = `<h3 class="text-lg">Practice Your Knowledge</h3><p class="text-sm font-normal text-slate-200">Start a quick quiz on ${title}.</p>`;
                            startQuizBtn.onclick = () => {
                                checkForSavedQuiz(quizId, item.questions, { title, subtitle, content }, startPracticeQuiz);
                            };
                            element.appendChild(startQuizBtn);
                            break;
                        case 'jumbled_quiz':
                            element = document.createElement('div');
                            element.className = 'mt-8';
                            const jumbledQuizId = `jumbled-${title.replace(/\s+/g, '-').toLowerCase()}`;
                            const startJumbledQuizBtn = document.createElement('button');
                            startJumbledQuizBtn.className = 'mode-card grad-nav text-white font-bold p-4 rounded-xl w-full text-center';
                            startJumbledQuizBtn.innerHTML = `<h3 class="text-lg">${item.title}</h3><p class="text-sm font-normal text-slate-200">Unscramble the sentences to test your knowledge.</p>`;
                            startJumbledQuizBtn.onclick = () => {
                                checkForSavedQuiz(jumbledQuizId, item.questions, { title, subtitle, content }, startJumbledQuiz);
                            };
                            element.appendChild(startJumbledQuizBtn);
                            break;
                    }
                    if (element) contentContainer.appendChild(element);
                });
                
                section.appendChild(contentContainer);
                wordView.appendChild(section);

                categoryView.classList.add('hidden');
                wordView.classList.remove('hidden');
                document.getElementById('home-features').classList.add('hidden');
                bottomNav.classList.remove('hidden');
                navQuizBtn.disabled = true;
            }

            function startJumbledQuiz(questions, lessonData, quizId, savedState = null) {
                let score = savedState ? savedState.score : 0;
                let currentQuestionIndex = savedState ? savedState.currentQuestionIndex : 0;
                const shuffledJumbledQuestions = savedState ? savedState.questions : [...questions].sort(() => 0.5 - Math.random());
                const totalQuestions = shuffledJumbledQuestions.length;

                function displayJumbledQuestion() {
                    if (currentQuestionIndex >= totalQuestions) {
                        displayJumbledResults();
                        return;
                    }

                    const q = shuffledJumbledQuestions[currentQuestionIndex];
                    const shuffledWords = [...q.jumbled].sort(() => 0.5 - Math.random());

                    wordView.innerHTML = `
                        <div class="pop-in glass-ui p-6 rounded-2xl mx-4 max-w-3xl my-auto w-full">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold text-white">Unscramble the Sentence</h2>
                                <p class="text-gray-300">${currentQuestionIndex + 1} / ${totalQuestions}</p>
                            </div>
                            
                            <div id="jumbled-answer" class="bg-black/20 p-4 rounded-lg min-h-[6rem] mb-4 flex flex-wrap gap-2 items-center">
                                <!-- User's answer will go here -->
                            </div>

                            <div id="jumbled-bank" class="p-4 rounded-lg min-h-[6rem] flex flex-wrap gap-2 items-center justify-center border-2 border-dashed border-white/20">
                                ${shuffledWords.map(word => `<button class="jumbled-word bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full transition-transform duration-200 ease-in-out">${word}</button>`).join('')}
                            </div>

                            <div id="jumbled-feedback" class="mt-4 min-h-[2rem]"></div>
                            
                            <div class="mt-4 flex justify-end gap-4">
                                <button id="undo-jumbled-btn" class="mode-card bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50" disabled>Undo</button>
                                <button id="check-jumbled-btn" class="mode-card bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full">Check</button>
                                <button id="next-jumbled-btn" class="hidden mode-card bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full">Next</button>
                            </div>
                        </div>
                    `;

                    const answerContainer = document.getElementById('jumbled-answer');
                    const bankContainer = document.getElementById('jumbled-bank');
                    const feedbackContainer = document.getElementById('jumbled-feedback');
                    const checkBtn = document.getElementById('check-jumbled-btn');
                    const nextBtn = document.getElementById('next-jumbled-btn');
                    const undoBtn = document.getElementById('undo-jumbled-btn');

                    const updateUndoButtonState = () => {
                        undoBtn.disabled = answerContainer.children.length === 0;
                    };

                    const moveWord = (e) => {
                        if (e.target.classList.contains('jumbled-word')) {
                            if (e.target.parentElement === bankContainer) {
                                answerContainer.appendChild(e.target);
                            } else {
                                bankContainer.appendChild(e.target);
                            }
                            updateUndoButtonState();
                        }
                    };
                    
                    bankContainer.addEventListener('click', moveWord);
                    answerContainer.addEventListener('click', moveWord);

                    undoBtn.addEventListener('click', () => {
                        const lastWord = answerContainer.lastElementChild;
                        if (lastWord) {
                            bankContainer.appendChild(lastWord);
                            updateUndoButtonState();
                        }
                    });

                    checkBtn.addEventListener('click', () => {
                        const words = Array.from(answerContainer.children).map(btn => btn.textContent);
                        const userAnswer = words.join(' ').replace(/\s\?/g, '?');
                        
                        bankContainer.removeEventListener('click', moveWord);
                        answerContainer.removeEventListener('click', moveWord);
                        bankContainer.style.opacity = 0.5;
                        
                        const wasCorrect = userAnswer.trim().toLowerCase() === q.correct.trim().toLowerCase();

                        if (wasCorrect) {
                            feedbackContainer.innerHTML = `<p class="text-green-400 font-bold text-center">Correct!</p>`;
                            score++;
                        } else {
                            feedbackContainer.innerHTML = `<p class="text-red-400 font-bold text-center">Not quite. The correct answer is: "${q.correct}"</p>`;
                        }
                        checkBtn.classList.add('hidden');
                        undoBtn.classList.add('hidden');
                        nextBtn.classList.remove('hidden');
                    });

                    nextBtn.addEventListener('click', () => {
                        currentQuestionIndex++;
                        saveQuizState(quizId, {
                            score: score,
                            currentQuestionIndex: currentQuestionIndex,
                            questions: shuffledJumbledQuestions
                        });
                        displayJumbledQuestion();
                    });
                }
                
                function displayJumbledResults() {
                    addQuizResult(lessonData.title, score, totalQuestions);
                    clearQuizState(quizId);
                    wordView.innerHTML = `
                        <div class="pop-in glass-ui p-6 rounded-2xl text-center mx-4 max-w-3xl my-auto">
                            <h2 class="text-2xl font-bold text-white mb-4">Practice Complete!</h2>
                            <p class="text-xl mb-6 text-gray-200">You scored ${score} out of ${totalQuestions}!</p>
                            <div class="flex justify-center gap-4">
                                <button id="restart-jumbled" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full">Try Again</button>
                                <button id="return-to-lesson" class="bg-white/20 hover:bg-white/30 text-white font-bold py-2 px-4 rounded-full">Back to Lesson</button>
                            </div>
                        </div>
                    `;
                    document.getElementById('restart-jumbled').onclick = () => startJumbledQuiz(questions, lessonData, quizId);
                    document.getElementById('return-to-lesson').onclick = () => renderStudyHallLesson(lessonData.title, lessonData.subtitle, lessonData.content);
                }
                
                wordView.innerHTML = '';
                setTimeout(() => { wordView.scrollTop = 0; }, 0);
                wordView.classList.add('active', 'flex', 'items-center', 'justify-center');
                displayJumbledQuestion();
            }

            function startPracticeQuiz(questions, lessonData, quizId, savedState = null) {
                let score = savedState ? savedState.score : 0;
                let currentQuestionIndex = savedState ? savedState.currentQuestionIndex : 0;
                
                const shuffledQuestions = savedState ? savedState.questions : [...questions].sort(() => 0.5 - Math.random());
                const totalQuestions = shuffledQuestions.length;

                function displayPracticeQuestion() {
                    if (currentQuestionIndex >= totalQuestions) {
                        displayPracticeResults();
                        return;
                    }

                    const q = shuffledQuestions[currentQuestionIndex];
                    const shuffledOptions = [...q.options].sort(() => 0.5 - Math.random());
                    wordView.innerHTML = `
                        <div class="pop-in glass-ui p-6 rounded-2xl mx-4 max-w-3xl my-auto">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold text-white">Concept Check!</h2>
                                <p class="text-gray-300">${currentQuestionIndex + 1} / ${totalQuestions}</p>
                            </div>
                            <p class="text-2xl font-bold mb-6 text-center text-white">${q.question}</p>
                            <div class="grid grid-cols-1 gap-4">
                                ${shuffledOptions.map(option => `<button class="quiz-option p-4 rounded-xl text-left">${option}</button>`).join('')}
                            </div>
                        </div>
                    `;
                    
                    wordView.querySelectorAll('.quiz-option').forEach(button => {
                        button.addEventListener('click', (e) => handlePracticeAnswer(button.textContent, q.correct_answer, e.target));
                    });
                }

                function handlePracticeAnswer(selectedAnswer, correctAnswer, button) {
                    const allOptions = wordView.querySelectorAll('.quiz-option');
                    allOptions.forEach(btn => btn.disabled = true);
                    
                    const wasCorrect = selectedAnswer === correctAnswer;

                    if (wasCorrect) {
                        button.classList.add('correct', 'celebrate');
                        button.addEventListener('animationend', () => button.classList.remove('celebrate'), { once: true });
                        score++;
                    } else {
                        button.classList.add('incorrect');
                        allOptions.forEach(btn => {
                            if (btn.textContent === correctAnswer) btn.classList.add('correct');
                        });
                    }
                    
                    setTimeout(() => {
                        currentQuestionIndex++;
                        saveQuizState(quizId, {
                            score: score,
                            currentQuestionIndex: currentQuestionIndex,
                            questions: shuffledQuestions
                        });
                        displayPracticeQuestion();
                    }, 1500);
                }

                function displayPracticeResults() {
                    addQuizResult(lessonData.title, score, totalQuestions);
                    clearQuizState(quizId);
                    wordView.innerHTML = `
                        <div class="pop-in glass-ui p-6 rounded-2xl text-center mx-4 max-w-3xl my-auto">
                            <h2 class="text-2xl font-bold text-white mb-4">Practice Complete!</h2>
                            <p class="text-xl mb-6 text-gray-200">You scored ${score} out of ${totalQuestions}!</p>
                            <div class="flex justify-center gap-4">
                                <button id="restart-practice" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full">Try Again</button>
                                <button id="return-to-lesson" class="bg-white/20 hover:bg-white/30 text-white font-bold py-2 px-4 rounded-full">Back to Lesson</button>
                            </div>
                        </div>
                    `;
                    document.getElementById('restart-practice').onclick = () => startPracticeQuiz(questions, lessonData, quizId);
                    document.getElementById('return-to-lesson').onclick = () => renderStudyHallLesson(lessonData.title, lessonData.subtitle, lessonData.content);
                }

                wordView.innerHTML = '';
                setTimeout(() => { wordView.scrollTop = 0; }, 0);
                wordView.classList.add('active', 'flex', 'items-center', 'justify-center');
                displayPracticeQuestion();
            }

            function renderAlphabetGrid(gradientClass) {
                wordView.innerHTML = '';
                setTimeout(() => { wordView.scrollTop = 0; }, 0);
                document.body.classList.add('view-active');
                appContainer.classList.remove('p-4');
                wordView.classList.add('active');
                
                // Create and add the title header
                const headerWrapper = document.createElement('div');
                headerWrapper.className = 'fixed top-0 left-0 right-0 z-40 bg-[#1F2335] py-2';
                const headerPill = document.createElement('div');
                headerPill.className = 'grad-nav rounded-full flex justify-center items-center max-w-sm md:max-w-md mx-auto p-2';
                const heading = document.createElement('h2');
                heading.className = "text-lg md:text-xl font-bold text-white text-center";
                heading.textContent = 'Synonyms';
                headerPill.appendChild(heading);
                headerWrapper.appendChild(headerPill);
                wordView.appendChild(headerWrapper);

                const section = document.createElement('section');
                section.className = "pop-in p-4 pt-24 pb-24"; // Added padding to account for the fixed header
                section.id = "alphabet-grid-section";

                const glassContainer = document.createElement('div');
                glassContainer.className = "glass-ui p-4 rounded-2xl"

                const gridHeading = document.createElement('h2');
                gridHeading.className = "text-xl sm:text-2xl font-bold text-white mb-6 border-b-2 border-white/20 pb-2";
                gridHeading.textContent = 'Select a Letter';
                glassContainer.appendChild(gridHeading);

                const grid = document.createElement('div');
                grid.className = "grid grid-cols-5 sm:grid-cols-7 gap-3";
                
                for (let i = 65; i <= 90; i++) {
                    const letter = String.fromCharCode(i);
                    const button = document.createElement('button');
                    button.textContent = letter;
                    button.className = "bg-white/10 hover:bg-white/20 text-white font-bold rounded-full w-10 h-10 flex items-center justify-center transition";
                    button.addEventListener('click', () => {
                         renderSynonymList(letter, gradientClass);
                    });
                    grid.appendChild(button);
                }

                glassContainer.appendChild(grid);
                section.appendChild(glassContainer);
                wordView.appendChild(section);
                
                categoryView.classList.add('hidden');
                wordView.classList.remove('hidden');
                bottomNav.classList.remove('hidden');
                navQuizBtn.disabled = true;
            }

            function renderSynonymList(letter, gradientClass) {
                // Push the A-Z grid view to the stack so we can go back to it
                navStack.push({ renderFunc: renderAlphabetGrid, args: [gradientClass] });
                
                const words = originalSynonymsData[letter] || [];
                const title = `Synonyms: ${letter}`;
                
                // The third arg (appendTo) is not used anymore with the new logic, pass null
                renderWords(title, words, null, gradientClass, { isSynonymSublist: true });
            }
            
            function renderWords(title, words, appendTo, gradientClass, options = {}) {
                const { isFavorites = false, isSearch = false, isSynonymSublist = false } = options;

                activeWordItem = null;
                currentWordListData = { title, words };
                let mainContainer;
                let listContainer;

                // --- 1. Set up the main container and header ---
                wordView.innerHTML = '';
                setTimeout(() => { wordView.scrollTop = 0; }, 0);
                document.body.classList.add('view-active');
                appContainer.classList.remove('p-4');
                wordView.classList.add('active');
                categoryView.classList.add('hidden');
                document.getElementById('home-features').classList.add('hidden');
                wordView.classList.remove('hidden');
                mainContainer = wordView;

                // --- Unified Header Creation ---
                const headerWrapper = document.createElement('div');
                headerWrapper.className = 'fixed top-0 left-0 right-0 z-40 bg-[#1F2335] py-2';
                
                const headerPill = document.createElement('div');
                const pillBaseClasses = 'grad-nav rounded-full flex items-center max-w-sm md:max-w-md mx-auto p-2';
                
                if (isSynonymSublist) {
                    headerPill.className = `${pillBaseClasses} justify-between`;
                } else {
                    headerPill.className = `${pillBaseClasses} justify-center`;
                    headerWrapper.addEventListener('click', () => { wordView.scrollTo({ top: 0, behavior: 'smooth' }); });
                }

                const heading = document.createElement('h2');
                heading.className = "text-lg md:text-xl font-bold text-white text-center";
                if (isSynonymSublist) {
                    heading.classList.add('flex-grow');
                }
                heading.textContent = title;
                headerPill.appendChild(heading);

                if (isSynonymSublist) {
                    const browseBtn = document.createElement('button');
                    browseBtn.textContent = 'A-Z';
                    browseBtn.className = 'text-sm bg-white/20 hover:bg-white/30 text-white font-bold py-1 px-3 rounded-full transition-colors ml-4 flex-shrink-0';
                    browseBtn.onclick = goBack;
                    headerPill.appendChild(browseBtn);
                }
                
                headerWrapper.appendChild(headerPill);
                mainContainer.appendChild(headerWrapper);

                const section = document.createElement('section');
                section.className = "pop-in";
                listContainer = document.createElement('div');
                listContainer.className = `p-4 max-w-2xl mx-auto pb-24 pt-24`; // Consistent padding
                section.appendChild(listContainer);
                mainContainer.appendChild(section);

                bottomNav.classList.remove('hidden');
                
                
                // --- 2. Populate the list (This logic is now shared) ---
                const list = document.createElement('div');
                list.className = "space-y-4";
                
                if (words.length === 0) {
                    const message = isFavorites ? 'You haven\'t saved any favorites yet.' : (isSearch ? 'No results found.' : 'This category is empty.');
                    list.innerHTML = `<p class="text-center text-gray-400 mt-4">${message}</p>`;
                    navQuizBtn.disabled = true;
                } else {
                    const hasFlippableWords = words.some(w => !w.type);
                    const quizPossible = hasFlippableWords && words.length >= 4;
                    navQuizBtn.disabled = !quizPossible;
                }
                
                words.forEach(item => {
                    if (item.type === 'explanation' || item.type === 'root') {
                        const explanationItem = document.createElement('div');
                        explanationItem.className = 'explanation-card p-3 sm:p-4';
                        explanationItem.innerHTML = `<p class="text-sm sm:text-base font-semibold">${item.title}</p>${item.meaning ? `<p class="text-xs sm:text-sm text-slate-600">${item.meaning}</p>` : ''}`;
                        explanationItem.addEventListener('click', () => showExplanationModal(item.title));
                        list.appendChild(explanationItem);
                        return;
                    }

                    const wordItem = document.createElement('div');
                    wordItem.className = "word-item";
                    const wordCardInner = document.createElement('div');
                    wordCardInner.className = 'word-card-inner';
                    const frontContent = document.createElement('div');
                    frontContent.className = "word-content front p-3 sm:p-4";
                    const backContent = document.createElement('div');
                    backContent.className = "word-content back p-3 sm:p-4";

                    const isOneWordSub = title.includes('One Word Substitution');
                    const isAntonymList = title === 'Antonyms';
                    const frontWord = isOneWordSub ? item.meaning : item.word;
                    const backWord = isAntonymList ? item.antonym : (isOneWordSub ? item.word : (item.synonyms ? `Synonyms: ${item.synonyms.join(', ')}` : (item.example || item.meaning)));
                    const isFavorited = favorites.some(fav => fav.word === item.word);

                    frontContent.innerHTML = `
                        <div class="flex justify-between items-center w-full gap-4">
                            <div class="text-left flex-grow">
                                <p class="text-sm sm:text-base font-semibold">${frontWord}</p>
                                ${ (item.meaning && !isOneWordSub && !isSynonymSublist) ? `<p class="text-xs sm:text-sm text-slate-600">${item.meaning}</p>` : '' }
                                ${ (isSynonymSublist) ? `<p class="text-xs sm:text-sm text-slate-600">${item.meaning}</p>` : '' }
                            </div>
                            <button class="favorite-btn flex-shrink-0 p-1 ${isFavorited ? 'favorited' : ''}" data-word="${item.word.replace(/"/g, '&quot;')}"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-400"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg></button>
                            ${ !isOneWordSub ? `<div class="speak-button flex-shrink-0" data-speak="${item.word}"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="text-gray-400"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg></div>` : '' }
                        </div>
                    `;
                        backContent.innerHTML = `
                        <div class="flex justify-between items-center w-full gap-4">
                            ${ isAntonymList ? `<div class="text-left flex-grow"><p class="text-white font-semibold">${item.antonym}</p><p class="text-xs text-slate-300">${item.antonym_meaning}</p></div>` : `<p class="text-sm text-white leading-tight text-left flex-grow">${backWord}</p>`}
                            ${ isAntonymList ? `<div class="speak-button flex-shrink-0" data-speak="${item.antonym}"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="text-gray-400"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg></div>` : '' }
                            ${ isOneWordSub ? `<div class="speak-button flex-shrink-0" data-speak="${item.word}"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="text-gray-400"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg></div>` : '' }
                        </div>`;

                    wordCardInner.appendChild(frontContent);
                    wordCardInner.appendChild(backContent);
                    wordItem.appendChild(wordCardInner);

                    wordItem.addEventListener('click', (e) => {
                        const target = e.target;
                        if (target.closest('.speak-button')) speakText(target.closest('.speak-button').dataset.speak);
                        else if (target.closest('.favorite-btn')) toggleFavorite(target.closest('.favorite-btn'));
                        else {
                            if (activeWordItem && activeWordItem !== wordItem) activeWordItem.classList.remove('active');
                            wordItem.classList.toggle('active');
                            activeWordItem = wordItem.classList.contains('active') ? wordItem : null;
                        }
                    });
                    list.appendChild(wordItem);
                });

                listContainer.appendChild(list);
            }
            
            // --- Favorites Logic ---
            function loadFavorites() {
                favorites = JSON.parse(localStorage.getItem('lingoFavorites') || '[]');
            }
            function saveFavorites() {
                localStorage.setItem('lingoFavorites', JSON.stringify(favorites));
            }
            function toggleFavorite(button) {
                const wordString = button.dataset.word;
                const wordData = allWords.find(w => w.word === wordString);
                if (!wordData) return;

                const index = favorites.findIndex(fav => fav.word === wordData.word);
                if (index > -1) {
                    favorites.splice(index, 1);
                    button.classList.remove('favorited');
                } else {
                    favorites.push(wordData);
                    button.classList.add('favorited');
                }
                saveFavorites();
            }

            // --- Other Logic ---
            function flattenVocabulary(data, path = []) {
                let words = [];
                for (const key in data) {
                    const newPath = [...path, key];
                    if (key === 'Synonyms' || key === 'Confusing Words' || key === 'Word Roots (Etymology)' || key === 'Study Hall') continue;
                    const value = data[key];
                    if (Array.isArray(value)) {
                        words = words.concat(value.map(v => ({...v, category: newPath.join(' > ')})));
                    } else if (typeof value === 'object' && value !== null) {
                        words = words.concat(flattenVocabulary(value, newPath));
                    }
                }
                return words;
            }

            
            function displaySuggestions(suggestions) {
                searchSuggestions.innerHTML = '';
                if (suggestions.length > 0) {
                    suggestions.slice(0, 5).forEach(item => {
                        const div = document.createElement('div');
                        div.textContent = item.word;
                        div.className = 'p-3 text-white cursor-pointer hover:bg-white/10';
                        div.onclick = () => {
                            navStack.push({ renderFunc: renderCategories, args: [vocabularyData] });
                            renderWords(`Search: "${item.word}"`, [item], false, 'grad-1', { isSearch: true });
                            clearSuggestions();
                        };
                        searchSuggestions.appendChild(div);
                    });
                    searchSuggestions.classList.remove('hidden');
                } else {
                    clearSuggestions();
                }
            }

            function clearSuggestions() {
                searchSuggestions.innerHTML = '';
                searchSuggestions.classList.add('hidden');
            }

            function renderDictionary() {
                document.body.classList.add('view-active');
                appContainer.classList.remove('p-4');
                wordView.innerHTML = '';
                setTimeout(() => { wordView.scrollTop = 0; }, 0);
                categoryView.classList.add('hidden');
                document.getElementById('home-features').classList.add('hidden');
                wordView.classList.add('active');
                wordView.classList.remove('hidden');
                bottomNav.classList.remove('hidden');
                navQuizBtn.disabled = true;

                const section = document.createElement('section');
                section.className = 'pop-in p-4';
                section.innerHTML = `
                    <div class="glass-ui p-4 sm:p-6 rounded-2xl max-w-2xl mx-auto">
                        <h2 class="text-3xl font-bold text-white mb-4">Dictionary</h2>
                        <div class="flex flex-col sm:flex-row gap-3 mb-4">
                            <input type="text" id="dictionary-search-input" placeholder="Enter a word..." class="w-full bg-white/10 text-white placeholder-white/50 border-2 border-transparent focus:border-pink-500 focus:bg-white/20 rounded-full py-2 px-4 outline-none transition-all">
                            <button id="dictionary-search-btn" class="grad-nav text-white font-bold py-2 px-4 rounded-full">Search</button>
                        </div>
                        <div id="dictionary-result-container" class="dictionary-result mt-4">
                           <div id="dictionary-placeholder">
                                <p class="text-slate-400">Search for any English word to see its definition, pronunciation, and examples.</p>
                            </div>
                        </div>
                    </div>
                `;
                wordView.appendChild(section);

                const searchInput = document.getElementById('dictionary-search-input');
                const searchBtn = document.getElementById('dictionary-search-btn');

                const searchWord = async () => {
                    const word = searchInput.value.trim();
                    if (!word) return;
                    searchInput.value = '';
                    
                    const resultContainer = document.getElementById('dictionary-result-container');
                    
                    resultContainer.innerHTML = `<div class="flex justify-center items-center py-8"><svg class="animate-spin h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div>`;

                    try {
                        const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                        if (!response.ok) throw new Error('Word not found');
                        const data = await response.json();
                        displayDictionaryResult(data[0]);
                    } catch (error) {
                        resultContainer.innerHTML = `<p class="text-red-400 font-semibold">Sorry, the word "${word}" could not be found. Please check the spelling and try again.</p>`;
                    }
                };

                searchBtn.addEventListener('click', searchWord);
                searchInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') searchWord();
                });
            }

            function displayDictionaryResult(data) {
                const resultContainer = document.getElementById('dictionary-result-container');
                resultContainer.innerHTML = '';
                let audioSrc = data.phonetics.find(p => p.audio)?.audio;

                let meaningsHTML = data.meanings.map(meaning => `
                    <div>
                        <h4 class="inline-block text-lg font-bold italic bg-clip-text text-transparent grad-3 pb-1">${meaning.partOfSpeech}</h4>
                        <div class="mt-2 space-y-3 text-slate-700">
                            ${meaning.definitions.map((def, index) => `
                                <div class="flex">
                                    <span class="text-slate-400 mr-3">${index + 1}.</span>
                                    <div>
                                        <p>${def.definition}</p>
                                        ${def.example ? `<p class="text-sm text-slate-500 italic mt-1">e.g. "${def.example}"</p>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');

                const resultCard = document.createElement('div');
                resultCard.className = 'bg-slate-50 rounded-2xl p-4 sm:p-6 pop-in mt-4';
                resultCard.innerHTML = `
                    <div class="flex justify-between items-center border-b border-slate-200 pb-3 mb-4">
                        <div>
                            <h3 class="text-3xl font-bold text-slate-800">${data.word}</h3>
                            <p class="text-slate-500">${data.phonetic || ''}</p>
                        </div>
                        ${audioSrc ? `<button id="dict-audio-btn" class="p-3 rounded-full bg-slate-200 hover:bg-slate-300 transition-colors text-slate-600"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg></button>` : ''}
                    </div>
                    <div class="space-y-6">${meaningsHTML}</div>
                `;
                
                resultContainer.appendChild(resultCard);

                if (audioSrc) {
                    document.getElementById('dict-audio-btn').addEventListener('click', () => {
                        new Audio(audioSrc).play();
                    });
                }
            }

            function showExplanationModal(title) {
                const content = detailedExplanations[title];
                if (content) {
                    explanationContent.innerHTML = content;
                    explanationModal.classList.remove('hidden');
                }
            }


            // --- Quiz Logic ---
            
            function saveQuizState(quizId, state) {
                localStorage.setItem(quizId, JSON.stringify(state));
            }

            function loadQuizState(quizId) {
                const savedState = localStorage.getItem(quizId);
                return savedState ? JSON.parse(savedState) : null;
            }

            function clearQuizState(quizId) {
                localStorage.removeItem(quizId);
            }

            function checkForSavedQuiz(quizId, questions, lessonData, startQuizFunction) {
                const savedState = loadQuizState(quizId);
                if (savedState) {
                    wordView.innerHTML = `
                        <div class="pop-in glass-ui p-6 rounded-2xl text-center mx-4 max-w-lg my-auto">
                            <h2 class="text-2xl font-bold text-white mb-4">Resume Quiz?</h2>
                            <p class="text-xl mb-6 text-gray-200">You have a quiz in progress. Do you want to continue?</p>
                            <div class="flex justify-center gap-4">
                                <button id="resume-quiz-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full">Resume</button>
                                <button id="restart-quiz-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full">Restart</button>
                            </div>
                        </div>
                    `;
                    wordView.classList.add('active', 'flex', 'items-center', 'justify-center');
                    document.getElementById('resume-quiz-btn').onclick = () => {
                        startQuizFunction(questions, lessonData, quizId, savedState);
                    };
                    document.getElementById('restart-quiz-btn').onclick = () => {
                        clearQuizState(quizId);
                        startQuizFunction(questions, lessonData, quizId);
                    };
                } else {
                    startQuizFunction(questions, lessonData, quizId);
                }
            }

            function showQuizOptions() {
                wordView.scrollTop = 0;
                wordView.innerHTML = `
                    <div class="pop-in glass-ui p-6 rounded-2xl mx-4">
                        <h2 class="text-2xl font-bold text-white mb-6 text-center">Select Quiz Length</h2>
                        <div id="quiz-length-selection" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button class="mode-card p-4 rounded-xl text-left" data-length="short">
                                <h3 class="font-bold text-lg text-white">Short Quiz</h3>
                                <p class="text-sm text-slate-300">A quick quiz with 10 random words.</p>
                            </button>
                            <button class="mode-card p-4 rounded-xl text-left" data-length="long">
                                <h3 class="font-bold text-lg text-white">Long Quiz</h3>
                                <p class="text-sm text-slate-300">Test all words in this category.</p>
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('quiz-length-selection').addEventListener('click', (e) => {
                    const lengthButton = e.target.closest('.mode-card');
                    if (lengthButton && !lengthButton.disabled) {
                        const length = lengthButton.dataset.length;
                        showQuizTypeOptions(length);
                    }
                });
            }

            function showQuizTypeOptions(quizLength) {
                const { words, title } = currentWordListData;
                wordView.scrollTop = 0;
                wordView.innerHTML = `
                    <div class="pop-in glass-ui p-6 rounded-2xl mx-4">
                        <h2 class="text-2xl font-bold text-white mb-6 text-center">Select Quiz Mode</h2>
                        <div id="quiz-mode-selection" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button class="mode-card p-4 rounded-xl text-left" data-mode="word-to-meaning">
                                <h3 class="font-bold text-lg text-white">Choose the Correct Meaning</h3>
                                <p class="text-sm text-slate-300">Guess the meaning of the word.</p>
                            </button>
                            <button class="mode-card p-4 rounded-xl text-left" data-mode="meaning-to-word">
                                <h3 class="font-bold text-lg text-white">Choose the Correct Word</h3>
                                <p class="text-sm text-slate-300">Guess the word from the meaning.</p>
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('quiz-mode-selection').addEventListener('click', (e) => {
                    const modeButton = e.target.closest('.mode-card');
                    if (modeButton && !modeButton.disabled) {
                        const mode = modeButton.dataset.mode;
                        const quizId = `vocab-${title.replace(/\s+/g, '-').toLowerCase()}-${mode}-${quizLength}`;
                        checkForSavedQuiz(quizId, words, { title }, (qWords, qData, qId, savedState) => startQuiz(qWords, qData.title, mode, quizLength, qId, savedState));
                    }
                });
            }
            
            function startQuiz(words, originalTitle, quizType, quizLength, quizId, savedState = null) {
                let score = savedState ? savedState.score : 0;
                let currentQuestionIndex = savedState ? savedState.currentQuestionIndex : 0;
                const quizzableWords = words.filter(w => !w.type);
                
                const quizWords = savedState ? savedState.questions : (quizLength === 'short' 
                    ? [...quizzableWords].sort(() => 0.5 - Math.random()).slice(0, 10) 
                    : [...quizzableWords].sort(() => 0.5 - Math.random()));

                const totalQuestions = quizWords.length;
                const isOneWordSub = originalTitle.includes('One Word Substitution');
                const isAntonymList = originalTitle === 'Antonyms';

                function displayQuestion() {
                    if (currentQuestionIndex >= totalQuestions) {
                        displayResults();
                        return;
                    }

                    const questionItem = quizWords[currentQuestionIndex];
                    let questionText, correctAnswer;
                    let options = [];

                    switch (quizType) {
                        case 'meaning-to-word':
                            if (isAntonymList) {
                                questionText = `What word is the antonym of "${questionItem.antonym}"?`;
                            } else {
                                questionText = questionItem.meaning;
                            }
                            correctAnswer = questionItem.word;
                            options.push(correctAnswer);
                            while (options.length < 4) {
                                const randomItem = quizzableWords[Math.floor(Math.random() * quizzableWords.length)];
                                if (randomItem.word && !options.includes(randomItem.word)) {
                                    options.push(randomItem.word);
                                }
                            }
                            break;
                        default: // 'word-to-meaning'
                            questionText = isAntonymList ? `What is the antonym of "${questionItem.word}"?` : (isOneWordSub ? questionItem.meaning : questionItem.word);
                            correctAnswer = isAntonymList ? questionItem.antonym : (isOneWordSub ? questionItem.word : questionItem.meaning);
                             options.push(correctAnswer);
                            while (options.length < 4) {
                                const randomItem = quizzableWords[Math.floor(Math.random() * quizzableWords.length)];
                                let randomAnswer = isAntonymList ? randomItem.antonym : (isOneWordSub ? randomItem.word : randomItem.meaning);
                                if (randomAnswer && !options.includes(randomAnswer)) {
                                    options.push(randomAnswer);
                                }
                            }
                            break;
                    }
                    
                    options.sort(() => 0.5 - Math.random());

                    wordView.innerHTML = `
                        <div class="pop-in glass-ui p-6 rounded-2xl mx-4">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold text-white">Quiz Time!</h2>
                                <p class="text-gray-300">${currentQuestionIndex + 1} / ${totalQuestions}</p>
                            </div>
                            <p class="text-2xl font-bold mb-6 text-center text-white">${questionText}</p>
                            <div id="quiz-options" class="grid grid-cols-1 gap-4">
                                ${options.map(option => `<button class="quiz-option p-4 rounded-xl text-left">${option}</button>`).join('')}
                            </div>
                        </div>
                    `;

                    document.querySelectorAll('.quiz-option').forEach(button => {
                        button.addEventListener('click', (e) => handleAnswer(button.textContent, correctAnswer, e.target));
                    });
                }
                
                function handleAnswer(selectedAnswer, correctAnswer, button) {
                    const allOptions = document.querySelectorAll('.quiz-option');
                    allOptions.forEach(btn => btn.disabled = true);

                    const wasCorrect = selectedAnswer === correctAnswer;

                    if (wasCorrect) {
                        button.classList.add('correct');
                        button.classList.add('celebrate');
                        button.addEventListener('animationend', () => button.classList.remove('celebrate'), { once: true });
                        score++;
                    } else {
                        button.classList.add('incorrect');
                        allOptions.forEach(btn => {
                            if (btn.textContent === correctAnswer) btn.classList.add('correct');
                        });
                    }

                    setTimeout(() => {
                        currentQuestionIndex++;
                        saveQuizState(quizId, {
                            score: score,
                            currentQuestionIndex: currentQuestionIndex,
                            questions: quizWords,
                        });
                        displayQuestion();
                    }, 1500);
                }

                function displayResults() {
                    addQuizResult(`${originalTitle} Quiz`, score, totalQuestions);
                    clearQuizState(quizId);
                    wordView.innerHTML = `
                        <div class="pop-in glass-ui p-6 rounded-2xl text-center mx-4">
                            <h2 class="text-2xl font-bold text-white mb-4">Quiz Complete!</h2>
                            <p class="text-xl mb-6 text-gray-200">You scored ${score} out of ${totalQuestions}!</p>
                            <div class="flex justify-center gap-4">
                                <button id="restart-quiz" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full">Restart</button>
                                <button id="return-to-list" class="bg-white/20 hover:bg-white/30 text-white font-bold py-2 px-4 rounded-full">Return</button>
                            </div>
                        </div>
                    `;
                    document.getElementById('restart-quiz').onclick = () => showQuizOptions();
                    document.getElementById('return-to-list').onclick = () => renderWords(originalTitle, words);
                }
                
                displayQuestion();
            }
            
            function loadVoices() {
                synthVoices = speechSynthesis.getVoices();
                if (synthVoices.length === 0) {
                    speechSynthesis.onvoiceschanged = () => {
                        synthVoices = speechSynthesis.getVoices();
                    };
                }
            }

            function speakText(textToSpeak) {
                speechSynthesis.cancel();
                const cleanText = textToSpeak.replace(/[*_`]/g, '');
                const formattedText = cleanText.replace(/\s*\/\s*/g, ', ');
                const utterance = new SpeechSynthesisUtterance(formattedText);
                
                if (synthVoices.length > 0) {
                    const selectedVoice = synthVoices.find(v => v.lang === 'en-US' && /female|woman/i.test(v.name)) || synthVoices.find(v => v.lang === 'en-US');
                    if (selectedVoice) {
                        utterance.voice = selectedVoice;
                    }
                }
                
                utterance.lang = 'en-US';
                setTimeout(() => { 
                    speechSynthesis.speak(utterance);
                }, 50);
            }

            const goBack = () => {
                if (navStack.length > 0) {
                    const prevState = navStack.pop();
                    prevState.renderFunc(...prevState.args);
                }
            };
            const goHome = () => {
                navStack.length = 0;
                renderCategories(vocabularyData);
            };

            // --- Event Listeners ---
            navBackBtn.addEventListener('click', goBack);
            navHomeBtn.addEventListener('click', goHome);
            navFavoritesBtn.addEventListener('click', () => {
                navStack.push({ renderFunc: renderCategories, args: [vocabularyData] });
                renderWords("Favorites", favorites, false, 'grad-fav', { isFavorites: true });
            });
            navQuizBtn.addEventListener('click', () => {
                if(currentWordListData.words.length > 0) {
                    showQuizOptions();
                }
            });
            
            searchBar.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                if (query.length > 1) {
                    const suggestions = allWords.filter(item => item.word.toLowerCase().startsWith(query));
                    displaySuggestions(suggestions);
                } else {
                    clearSuggestions();
                }
            });

            searchBar.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const query = e.target.value.trim().toLowerCase();
                    if (query.length === 0) return;

                    clearSuggestions();
                    searchBar.blur();

                    const results = allWords.filter(item => 
                        item.word.toLowerCase().includes(query) || 
                        (item.meaning && item.meaning.toLowerCase().includes(query))
                    );
                    
                    navStack.push({ renderFunc: renderCategories, args: [vocabularyData] });
                    renderWords(`Search: "${query}"`, results, false, 'grad-1', { isSearch: true });
                }
            });

            document.addEventListener('click', (e) => {
                if (!searchContainer.contains(e.target)) {
                    clearSuggestions();
                }
            });
            
            aboutBtn.addEventListener('click', () => aboutModal.classList.remove('hidden'));
            closeAboutModal.addEventListener('click', () => aboutModal.classList.add('hidden'));
            aboutModal.addEventListener('click', (e) => {
                if (e.target === aboutModal) aboutModal.classList.add('hidden');
            });

            closeExplanationModal.addEventListener('click', () => explanationModal.classList.add('hidden'));
            explanationModal.addEventListener('click', (e) => {
                if (e.target === explanationModal) explanationModal.classList.add('hidden');
            });
            
            profileBtn.addEventListener('click', displayProfileModal);
            closeUserProfileModal.addEventListener('click', () => userProfileModal.classList.add('hidden'));
            userProfileModal.addEventListener('click', (e) => {
                if (e.target === userProfileModal) userProfileModal.classList.add('hidden');
            });

            saveProfileBtn.addEventListener('click', saveAndApplyProfile);

            const synonymsCategoryFunction = (gradientClass) => {
                renderAlphabetGrid(gradientClass);
            };
            vocabularyData["Synonyms"] = synonymsCategoryFunction;
            
            function init() {
                setTimeout(() => {
                    splashScreen.classList.add('splash-out');
                    splashScreen.addEventListener('animationend', () => {
                        splashScreen.style.display = 'none';
                        appContainer.classList.remove('opacity-0');

                        // Check for profile after splash screen animation
                        if (!loadProfile()) {
                            showProfileSetup();
                        } else {
                            renderCategories(vocabularyData);
                        }

                    }, { once: true });
                }, 1500);

                loadFavorites();
                
                allWords = [...new Set(flattenVocabulary(vocabularyData))];
                Object.values(originalSynonymsData).forEach(arr => allWords.push(...arr));
                allWords = [...new Set(allWords)];

                // Pre-load voices for TTS
                speechSynthesis.getVoices();
            }

            init();
        });
    </script>
</body>
</html>
